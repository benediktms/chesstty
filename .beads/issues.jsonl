{"id":"ct-00d","title":"Change legal move destination squares from tints to outlines","description":"After piece selection, legal move destinations are rendered as full-square background tints at fsm/mod.rs:248-249 using overlay.tint(sq, OverlayColor::LegalMove). This should use outline() instead so squares show border outlines rather than colored backgrounds. Fix: Change overlay.tint(sq, OverlayColor::LegalMove) to overlay.outline(sq, OverlayColor::LegalMove) in board_overlay(). Depends on outline rendering being wired into BoardWidget first.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T16:44:08Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T16:44:08Z","dependencies":[{"issue_id":"ct-00d","depends_on_id":"ct-7oh","type":"blocks","created_at":"2026-02-22T16:44:15Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-083","title":"Update config.rs with directories crate and DB path","description":"Use the directories crate for platform-native paths. Add get_db_path() (priority: CHESSTTY_DB_PATH env \u003e platform data dir \u003e ./data/chesstty.db). Rename existing get_data_dir() to get_legacy_data_dir(). Platform paths: macOS ~/Library/Application Support/chesstty, Linux ~/.local/share/chesstty. IMPORTANT: Also add 'export CHESSTTY_DB_PATH := \"data/chesstty.db\"' to the justfile alongside the existing CHESSTTY_DATA_DIR export, so local dev via just commands always targets the repo-root data directory for easier debugging.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:23:38Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T09:58:10Z","closed_at":"2026-02-22T09:58:10Z","close_reason":"Changes applied: mod.rs glue code (traits/sqlite modules, Sqlx error variant) and config.rs (get_db_path, get_legacy_data_dir rename, justfile update). cargo check passes.","labels":["relates_to:ct-config"],"dependencies":[{"issue_id":"ct-083","depends_on_id":"ct-at6","type":"blocks","created_at":"2026-02-22T00:25:51Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-0au","title":"CI: Build and test workflow","description":"Create a GitHub Actions workflow for building and testing the full workspace on every PR and push to master.\n\n## Workflow: .github/workflows/ci-test.yml\n\n### Steps\n1. Checkout code\n2. Install Rust stable toolchain\n3. Install protobuf compiler (protoc) — required for proto/build.rs tonic-build\n4. Cache dependencies (Swatinem/rust-cache@v2 with key based on Cargo.lock)\n5. Run `cargo build --workspace` (ensures proto compilation + all crates build)\n6. Run `cargo test --workspace` (unit + integration tests)\n\n### Matrix Strategy\n- OS: ubuntu-latest, macos-latest (arm64)\n- Rust: stable\n\n### Proto Compilation\n- Install protoc via `sudo apt-get install -y protobuf-compiler` (Linux) or `brew install protobuf` (macOS)\n- The proto crate's build.rs uses tonic-build to compile 10 .proto files\n- Proto must compile before dependent crates\n\n### Database Tests\n- Server has SQLite integration tests — sqlx auto-migrates on first run\n- Set CHESSTTY_DATA_DIR and CHESSTTY_DB_PATH env vars for test isolation\n- Create temp data directory before tests\n\n### Stockfish (optional)\n- Some integration tests may need Stockfish binary\n- Use scripts/install-stockfish.sh or install via package manager\n- Consider making Stockfish-dependent tests feature-gated\n\n### Caching Notes\n- Key on: runner.os, Cargo.lock hash, toolchain\n- Cache: ~/.cargo/registry, ~/.cargo/git, target/","notes":"Updated based on research (Feb 2026): Use cargo nextest for ~35-40% faster test runs + separate 'cargo test --doc' for doctests. Always use --locked flag for reproducible builds. Use arduino/setup-protoc@v3 with version pin (not apt). Use Swatinem/rust-cache@v2 with save-if: master. Set CARGO_TERM_COLOR=always, RUST_BACKTRACE=1. Use dtolnay/rust-toolchain@stable.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T18:11:54Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T21:25:41Z"}
{"id":"ct-0cb","title":"Create SQLite database module with sqlx pool","description":"Create server/src/persistence/sqlite/database.rs with Database struct holding SqlitePool. Configures WAL journal mode, foreign keys ON, max 5 connections. Runs sqlx migrations on connect. Provides new_in_memory() for tests. Create server/src/persistence/sqlite/mod.rs with re-exports and shared encode/decode helpers for AnalysisScore and ReviewStatus enums.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:23:42Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T10:18:57Z","closed_at":"2026-02-22T10:18:57Z","close_reason":"Database module with pool/migrations/tests created. All 5 JSON stores implement async repository traits. cargo check passes.","dependencies":[{"issue_id":"ct-0cb","depends_on_id":"ct-3oy","type":"blocks","created_at":"2026-02-22T00:25:52Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-0cb","depends_on_id":"ct-at6","type":"blocks","created_at":"2026-02-22T00:25:52Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-0cb","depends_on_id":"ct-i81","type":"blocks","created_at":"2026-02-22T00:25:53Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-0to","title":"Display user input text in widget during direct-typing flow","description":"The direct-typing input_buffer at render_loop.rs:366 is a local String variable that is never passed to any rendering widget. Characters are pushed at input.rs:221 but the user types blindly — no visual feedback. The tab-input flow (TabInputWidget) correctly displays its typeahead_buffer at tab_input.rs:91-93. Fix options: (A) Move input_buffer to FSM (add pub input_buffer: String to UiStateMachine) and display it in GameInfoPanel or a status bar, OR (B) Auto-activate TabInputWidget when user starts typing to unify both flows into one visible path. Option B is cleaner but changes existing UX.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T16:44:05Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T16:44:05Z"}
{"id":"ct-0z7","title":"Wire up SQLite repos in main.rs","description":"Update server/src/main.rs to: construct Database with get_db_path(), run JSON migration, create all 5 SQLite repos, pass to SessionManager and ReviewManager with generic type params. Remove old JSON store construction. Fix path-doubling bug (no longer relevant since SQLite repos don't use file paths).","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:24:07Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T13:30:12Z","closed_at":"2026-02-22T13:30:12Z","close_reason":"main.rs wired up with SQLite: Database::open, migrate_json_to_sqlite, 5 SQLite repos, generic SessionManager+ReviewManager. cargo check 0 errors, cargo test 127/127 pass.","labels":["relates_to:ct-uds"],"dependencies":[{"issue_id":"ct-0z7","depends_on_id":"ct-083","type":"blocks","created_at":"2026-02-22T00:26:03Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-0z7","depends_on_id":"ct-h3p","type":"blocks","created_at":"2026-02-22T00:26:02Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-0z7","depends_on_id":"ct-ns4","type":"blocks","created_at":"2026-02-22T00:26:03Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-0z7","depends_on_id":"ct-rc7","type":"blocks","created_at":"2026-02-22T00:26:02Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-0za","title":"CI: Code coverage reporting","description":"Add code coverage tracking to the CI pipeline.\n\n## Approach: cargo-llvm-cov (recommended over tarpaulin)\n\n### Why cargo-llvm-cov\n- Uses LLVM's native instrumentation (more accurate than tarpaulin)\n- Better workspace support\n- Faster execution\n- Active maintenance\n\n### Workflow Addition to ci-test.yml (or separate workflow)\n\n1. Install cargo-llvm-cov: `cargo install cargo-llvm-cov`\n2. Run: `cargo llvm-cov --workspace --lcov --output-path lcov.info`\n3. Upload to Codecov: `codecov/codecov-action@v4`\n\n### Configuration\n- Add codecov.yml to repo root:\n  ```yaml\n  coverage:\n    status:\n      project:\n        default:\n          target: auto\n          threshold: 2%\n      patch:\n        default:\n          target: 80%\n  ```\n- Consider excluding proto-generated code from coverage\n- Exclude test files themselves from coverage metrics\n\n### Notes\n- Requires Codecov account (free for open-source)\n- Alternative: coveralls via cargo-tarpaulin if Codecov not preferred\n- Coverage badge can be added to README\n- Consider running coverage only on ubuntu-latest to save CI minutes","notes":"Part of epic ct-gob","status":"open","priority":4,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T18:12:27Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T18:12:40Z","dependencies":[{"issue_id":"ct-0za","depends_on_id":"ct-0au","type":"blocks","created_at":"2026-02-22T18:12:32Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-11d","title":"Reduce ChessServiceImpl 5-arity generic","description":"ChessServiceImpl\u003cS,P,F,R,A\u003e carries 5 generic repository type params everywhere, monomorphizing into enormous types. Since persistence is I/O-bound, replace with trait objects (Arc\u003cdyn SessionRepository\u003e etc.) to eliminate the generic cascade. Files: server/src/service/mod.rs, session/manager.rs, review/manager.rs, all endpoint files. Complexity: Large.","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:56Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:56Z","dependencies":[{"issue_id":"ct-11d","depends_on_id":"ct-7vd","type":"blocks","created_at":"2026-02-23T19:11:00Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-137","title":"Audit and remove remaining #[allow(dead_code)] suppressions","description":"After all other Epic 1 tasks, re-run cargo clippy --workspace. Triage remaining 40+ #[allow(dead_code)] suppressions across ~15 files. For each: delete the dead code, or replace with documented TODO. Focus areas: chesstty/src/config.rs (8 suppressions), board_overlay.rs (9), menu.rs (8), server persistence stores. Verify: cargo clippy --workspace has zero dead_code warnings.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:01Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:01Z","dependencies":[{"issue_id":"ct-137","depends_on_id":"ct-1fj","type":"blocks","created_at":"2026-02-23T19:10:41Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-137","depends_on_id":"ct-29l","type":"blocks","created_at":"2026-02-23T19:10:41Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-137","depends_on_id":"ct-2ou","type":"blocks","created_at":"2026-02-23T19:10:43Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-137","depends_on_id":"ct-as5","type":"blocks","created_at":"2026-02-23T19:10:41Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-137","depends_on_id":"ct-ixc","type":"blocks","created_at":"2026-02-23T19:10:42Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-137","depends_on_id":"ct-mv0","type":"blocks","created_at":"2026-02-23T19:10:43Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-137","depends_on_id":"ct-x1a","type":"blocks","created_at":"2026-02-23T19:10:42Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-13y","title":"Unify GameMode into chess crate (single source of truth)","description":"GameMode is defined 3x with different variant names and has 4 separate converter functions plus ad-hoc string serialization. Delete client-tui/src/state.rs::GameMode, use chess::GameMode everywhere. Add impl FromStr and impl Display to chess::GameMode. Unify parse_stored_game_mode (persistence.rs:167-196) and parse_game_mode_string (review.rs:299-320) into single function. Add impl Display for PlayerSide. Files: chess/src/game.rs, client-tui/src/state.rs, server endpoints, server/src/session/mod.rs, server/src/session/state.rs. Complexity: Large.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:18Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:18Z"}
{"id":"ct-18s","title":"Update controls bar to show number-key hints instead of Tab","description":"In UiStateMachine::derive_controls (fsm/mod.rs:170-218), replace Control::new(\"Tab\", \"Panels\") (line 211) with per-panel number hints like Control::new(\"1-3\", \"Panels\") for game mode (InfoPanel, History, Engine) or Control::new(\"1-4\", \"Panels\") when DebugPanel is visible. Similarly update the ReviewBoard controls (line 186) to replace Control::new(\"Tab\", \"Tabs\") with the appropriate number range. The range should be dynamic based on visible panel count.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:07:33Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T01:05:37Z","closed_at":"2026-02-22T01:05:37Z","close_reason":"Implemented number-key selection across input handlers, controls bar, and widget borders","labels":["ui"],"dependencies":[{"issue_id":"ct-18s","depends_on_id":"ct-sgc","type":"blocks","created_at":"2026-02-22T00:07:53Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-1e8a2b90","title":"Implement Zwischenzug detector (heuristic)","description":"NEW heuristic detector for intermediate moves (intermezzo).\n\nAlgorithm:\n- Requires engine eval data (eval_before, eval_after, best_line from TacticalContext)\n- Tag Zwischenzug when ALL of:\n  1. The played move is forcing (check or capture)\n  2. It occurs in a local exchange context (previous move was capture OR current move is capture)\n  3. The move is NOT the top engine move (it's an intermezzo, not the main line)\n  4. Evaluation swing is significant (\u003e 50cp favorable shift or maintains advantage)\n- Confidence: medium (0.4-0.6), conservative is fine\n- Emit TacticalTag { kind: Zwischenzug, attacker: moved piece square, victims: [], target_square: move destination, confidence, note: short explanation }\n\nThis detector needs the played move + eval context, making it move-relative rather than purely geometric.\n\nDepends on: ct-ba75d59f (TacticalDetector trait).","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:45:03Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T16:17:44Z","closed_at":"2026-02-22T16:17:44Z","close_reason":"Implemented all 9 tactical detectors and reducer: skewer, fork+double_attack, hanging_piece, back_rank, discovered_attack, sacrifice, zwischenzug, mate_threat, and reducer. 63 tests pass, clippy clean.","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-1e8a2b90","depends_on_id":"ct-ba75d59f","type":"blocks","created_at":"2026-02-21T23:46:37Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-1e8a2b90","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:08Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-1fj","title":"Remove dead Daemon builder from chesstty/src/daemon.rs","description":"Delete lines ~194-711 from daemon.rs: the entire Daemon struct, Group enum, DaemonError (most variants), IoError wrapper, and all builder methods (~500 lines of dead unsafe code). Keep only read_pid, is_server_running, remove_stale_pid, and ProcessError (minus ProcessNotFound variant). Files: chesstty/src/daemon.rs. Verify: cargo build -p chesstty succeeds.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:41Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:08:41Z"}
{"id":"ct-1iv","title":"Add tests for number-key panel selection","description":"Unit and integration tests for number-key panel selection. Game mode: 1=InfoPanel, 2=EnginePanel, 3=HistoryPanel, 4=DebugPanel. Review mode: 1=InfoPanel, 2=HistoryPanel, 3=AdvancedAnalysis, 4=ReviewSummary. Tests cover: number key selection from board context, hidden panel does nothing, tab_input priority, Esc returns to board, number keys switch panels in component-selected context, review mode panel selection, and round-trip key mappings. Test file: tests/panel_selection_integration_tests.rs","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:07:47Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T01:23:59Z","closed_at":"2026-02-22T01:08:15Z","close_reason":"Added 8 unit tests for number_key/from_number_key and 8 integration tests for FSM-level selection","labels":["test"],"dependencies":[{"issue_id":"ct-1iv","depends_on_id":"ct-f3a","type":"blocks","created_at":"2026-02-22T00:07:54Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-1iv","depends_on_id":"ct-ig2","type":"blocks","created_at":"2026-02-22T00:07:55Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-1iv","depends_on_id":"ct-k7e","type":"blocks","created_at":"2026-02-22T00:07:54Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-1m0","title":"Gray out original panel when expanded pane is active","description":"When a panel is expanded (fills the board area), the original panel in the right column still shows with normal styling. This looks strange since both the expanded view and the original are visible simultaneously. The original panel should probably be grayed out or visually de-emphasized when its expanded version is active. Exact implementation TBD when picked up.","status":"open","priority":3,"issue_type":"bug","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T01:14:18Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T01:14:18Z"}
{"id":"ct-25w","title":"Fix piece selection: typeahead outlines, input display, destination outlines","description":"Epic for fixing the piece selection UX. Three interconnected issues: (1) typeahead-matching pieces should show OUTLINES not highlights, (2) user input text is not displayed in the widget (broken), (3) destination squares after piece selection should use OUTLINES not full-square tints. The outline rendering infrastructure (draw_square_outline, SquareOutline, OverlayColor::Typeahead) already exists but is dead code — never wired into the BoardWidget render loop.","status":"open","priority":1,"issue_type":"feature","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T16:43:52Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T16:43:52Z"}
{"id":"ct-29l","title":"Delete JSON persistence stores superseded by SQLite","description":"Delete the five JSON-based persistence stores all suppressed with #[allow(dead_code)]: PositionStore (position_store.rs), SessionStore (session_store.rs), FinishedGameStore (finished_game_store.rs), ReviewStore (review/store.rs), AdvancedAnalysisStore (review/advanced/store.rs). Also delete json_store.rs if no longer needed. Remove mod declarations from persistence/mod.rs and review/mod.rs. Files: 6+ files in server/src/persistence/ and server/src/review/. Verify: cargo build -p chesstty-server; cargo test -p chesstty-server.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:45Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:08:45Z"}
{"id":"ct-2f00bfc6","title":"Define TacticalTagKind enum and TacticalTag data model","description":"Replace the current TacticalPattern enum (tactics.rs) with the new data model:\n\n- TacticalTagKind enum: Fork, Pin, Skewer, DiscoveredAttack, DoubleAttack, HangingPiece, Sacrifice, Zwischenzug, BackRankWeakness, MateThreat\n- TacticalTag struct: kind, attacker (Option\u003cString\u003e), victims (Vec\u003cString\u003e), target_square (Option\u003cString\u003e), confidence (f32 0.0..1.0), note (Option\u003cString\u003e), evidence (TacticalEvidence)\n- TacticalEvidence struct: lines (Vec\u003cTacticalLine\u003e), threatened_pieces (Vec\u003cString\u003e), defended_by (Vec\u003cString\u003e)\n- TacticalLine struct: from (String), through (Vec\u003cString\u003e), to (String)\n\nStore squares as 'e4' strings for JSON stability. Keep Serialize/Deserialize derives. Place in analysis/src/board_analysis/tactical_types.rs (new file).\n\nCurrent code to refactor: analysis/src/board_analysis/tactics.rs lines 6-78 (SquareInfo, TacticalPattern, TacticalAnalysis). SquareInfo can be removed once all consumers migrate to string-based squares.","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:43:55Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T15:34:46Z","closed_at":"2026-02-22T15:34:46Z","close_reason":"Implemented TacticalTag model module with serde-compatible types and roundtrip tests in analysis crate.","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-2f00bfc6","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:05Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-2f9046bc","title":"Implement Skewer detector","description":"Rework the existing skewer detection from detect_pins_and_skewers() (tactics.rs:173-214) into a standalone detector implementing TacticalDetector.\n\nAlgorithm:\n- Similar to Pin but reversed value ordering: first enemy piece A is MORE valuable than behind piece B\n- Ray trace: sliding piece → front piece A → back piece B\n- If value(A) \u003e value(B) and our slider is on that ray → skewer\n- Confidence increases if A is king (forced to move, exposing B)\n\nEmit TacticalTag { kind: Skewer, attacker: slider square, victims: [front piece, back piece], target_square: None, confidence (0.9 if king front, 0.7 otherwise), evidence with TacticalLine }\n\nDepends on: ct-ba75d59f (TacticalDetector trait), ct-9f92e422 (AttackMap).","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:44:50Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T16:17:44Z","closed_at":"2026-02-22T16:17:44Z","close_reason":"Implemented all 9 tactical detectors and reducer: skewer, fork+double_attack, hanging_piece, back_rank, discovered_attack, sacrifice, zwischenzug, mate_threat, and reducer. 63 tests pass, clippy clean.","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-2f9046bc","depends_on_id":"ct-9f92e422","type":"blocks","created_at":"2026-02-21T23:46:34Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-2f9046bc","depends_on_id":"ct-ba75d59f","type":"blocks","created_at":"2026-02-21T23:46:34Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-2f9046bc","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:07Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-2l2","title":"Introduce thiserror to engine crate","description":"Replace Result\u003c_, String\u003e in engine crate with proper EngineError enum using thiserror. The engine crate is the only one using String errors -- all others use typed errors. Affects UCI parser, process management, and communication layer. Files: multiple in engine/src/. Complexity: Medium.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:37Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:37Z"}
{"id":"ct-2ou","title":"Remove dead MiniBoardWidget","description":"Delete client-tui/src/ui/widgets/mini_board.rs (empty_square_symbol + MiniBoardWidget never constructed). Remove mod and import from widgets/mod.rs and renderer.rs. Files: mini_board.rs, widgets/mod.rs, renderer.rs. Verify: cargo build -p client-tui.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:57Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:08:57Z"}
{"id":"ct-3ff69e18","title":"Wire pipeline orchestrator: run detectors and reduce","description":"Create the top-level pipeline function in analysis/src/board_analysis/pipeline.rs (new file) that replaces the current analyze_tactics().\n\nFunction: detect_tactics(before: \u0026Board, after: \u0026Board, mv: Option\u003cMove\u003e, eval_before: Option\u003ci32\u003e, eval_after: Option\u003ci32\u003e, best_line: Option\u003cVec\u003cString\u003e\u003e) -\u003e Vec\u003cTacticalTag\u003e\n\nSteps:\n1. Build AttackMap for before and after positions\n2. Construct TacticalContext from inputs + attack maps\n3. Run all registered detectors (HangingPiece, Fork/DoubleAttack, Pin, Skewer, DiscoveredAttack, Zwischenzug, BackRankWeakness, MateThreat, Sacrifice)\n4. Collect all Vec\u003cTacticalTag\u003e from detectors\n5. Pass through reducer (merge, dedupe, rank, cap)\n6. Return final Vec\u003cTacticalTag\u003e\n\nThis becomes the new public API replacing analyze_tactics(). The old analyze_tactics() can be deprecated/removed once consumers migrate.\n\nDepends on: ct-ba75d59f (trait), ct-9db898a6 (reducer), and all detector tasks.","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:45:27Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T17:09:21Z","closed_at":"2026-02-22T17:09:21Z","close_reason":"Work completed: all compilation errors fixed, 136 server tests + 89 analysis tests passing","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-3ff69e18","depends_on_id":"ct-1e8a2b90","type":"blocks","created_at":"2026-02-21T23:46:42Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-3ff69e18","depends_on_id":"ct-2f9046bc","type":"blocks","created_at":"2026-02-21T23:46:42Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-3ff69e18","depends_on_id":"ct-50d52ab1","type":"blocks","created_at":"2026-02-21T23:46:41Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-3ff69e18","depends_on_id":"ct-51018430","type":"blocks","created_at":"2026-02-21T23:46:43Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-3ff69e18","depends_on_id":"ct-9db898a6","type":"blocks","created_at":"2026-02-21T23:46:40Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-3ff69e18","depends_on_id":"ct-ba75d59f","type":"blocks","created_at":"2026-02-21T23:46:40Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-3ff69e18","depends_on_id":"ct-bd35649a","type":"blocks","created_at":"2026-02-21T23:46:41Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-3ff69e18","depends_on_id":"ct-c6bc09e0","type":"blocks","created_at":"2026-02-21T23:46:41Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-3ff69e18","depends_on_id":"ct-c8bcb338","type":"blocks","created_at":"2026-02-21T23:46:43Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-3ff69e18","depends_on_id":"ct-d131eae2","type":"blocks","created_at":"2026-02-21T23:46:43Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-3ff69e18","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:09Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-3ff69e18","depends_on_id":"ct-fa8f15d7","type":"blocks","created_at":"2026-02-21T23:46:42Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-3hc","title":"Implement SqlitePositionRepository","description":"Create server/src/persistence/sqlite/position_repo.rs. Implements PositionRepository trait. Handles default position seeding on first use if table is empty. List sorts defaults first by name, then user positions by created_at DESC. Delete rejects is_default=true with PersistenceError::DefaultPositionProtected. Add unit tests.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:23:49Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T10:40:38Z","closed_at":"2026-02-22T10:40:38Z","close_reason":"All 5 SQLite repos implemented and passing 39 tests","dependencies":[{"issue_id":"ct-3hc","depends_on_id":"ct-0cb","type":"blocks","created_at":"2026-02-22T00:25:55Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-3hc","depends_on_id":"ct-nxo","type":"blocks","created_at":"2026-02-22T00:25:55Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-3oy","title":"Update PersistenceError for sqlx","description":"Add Sqlx(#[from] sqlx::Error) variant to PersistenceError enum in server/src/persistence/mod.rs. Also add sqlx::migrate::MigrateError variant if needed. Declare the new sqlite submodule.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:23:23Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T10:15:46Z","closed_at":"2026-02-22T10:15:46Z","close_reason":"Already completed by ct-idk: Sqlx error variant and sqlite module declaration are in place.","dependencies":[{"issue_id":"ct-3oy","depends_on_id":"ct-at6","type":"blocks","created_at":"2026-02-22T00:25:46Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-3oy","depends_on_id":"ct-idk","type":"blocks","created_at":"2026-02-22T00:52:58Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-44u","title":"CI: Lint and format check workflow","description":"Create a GitHub Actions workflow for code quality checks that runs on every PR and push to master.\n\n## Workflow: .github/workflows/ci-lint.yml\n\n### Steps\n1. Checkout code\n2. Install Rust stable toolchain with rustfmt and clippy components\n3. Cache dependencies (use Swatinem/rust-cache@v2)\n4. Run `cargo fmt --all -- --check` (formatting)\n5. Run `cargo clippy --workspace --all-targets -- -D warnings` (linting)\n\n### Configuration\n- Trigger: push to master, pull_request to master\n- Runner: ubuntu-latest\n- Rust toolchain: stable\n- Cancel in-progress: true (concurrency group per PR)\n\n### Notes\n- Workspace already enforces unsafe_code=forbid and enum_glob_use=deny via workspace lints\n- This is the fastest check and should run first / in parallel with other CI jobs\n- Consider adding cargo-deny for license and advisory checks in the same job","notes":"Updated based on research (Feb 2026): Use dtolnay/rust-toolchain@stable (NOT actions-rs/cargo which is archived). Use arduino/setup-protoc@v3 with version pin '25.x' and repo-token. Use Swatinem/rust-cache@v2 with save-if: master to prevent PR cache pollution. Add RUSTFLAGS='-D warnings'. Add concurrency group with cancel-in-progress on PRs only.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T18:11:46Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T21:25:39Z"}
{"id":"ct-47s","title":"Codebase Cleanup \u0026 Consolidation","description":"Epic to address code duplication, naming inconsistencies, dead code, architectural issues, and API surface gaps discovered during comprehensive codebase exploration. Organized into 7 sub-epics with 27 tasks across 4 phases.","status":"open","priority":1,"issue_type":"feature","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:07Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:08:07Z"}
{"id":"ct-4dc","title":"Replace all get_socket_path() duplicates with common crate","description":"Add common as dependency to chesstty, server, and client-tui. Replace 5 local get_socket_path() implementations with common::get_socket_path(). Files: chesstty/src/config.rs, server/src/config.rs, client-tui/src/state.rs, client-tui/src/ui/render_loop.rs, client-tui/src/ui/fsm/mod.rs, plus 3 Cargo.toml files. Verify: grep -r 'fn get_socket_path' returns only common/src/lib.rs.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:10Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:10Z","dependencies":[{"issue_id":"ct-4dc","depends_on_id":"ct-5i6","type":"blocks","created_at":"2026-02-23T19:10:45Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-4eu","title":"Wire typeahead squares into board overlay as outlines","description":"render_loop.rs:431 computes typeahead_squares via filter_selectable_by_input() but the result is a dead binding — never passed to the overlay builder. OverlayColor::Typeahead exists at board_overlay.rs:29 but is unused. Fix: (1) Add typeahead_squares field to UiStateMachine in fsm/mod.rs, (2) update render_loop.rs to store computed squares on FSM instead of local var, (3) update board_overlay() in fsm/mod.rs:226 to accept/use typeahead_squares and call overlay.outline(sq, OverlayColor::Typeahead) for each, (4) update renderer.rs if board_overlay() signature changes.","status":"closed","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T16:44:01Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T11:38:48Z","closed_at":"2026-02-23T11:38:48Z","close_reason":"Wired typeahead squares into board overlay as outlines - added typeahead_squares field to UiStateMachine, store computed squares in render_loop, and render as outlines in board_overlay","dependencies":[{"issue_id":"ct-4eu","depends_on_id":"ct-7oh","type":"blocks","created_at":"2026-02-22T16:44:14Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-4iv","title":"Remove production unwrap() calls","description":"Replace unwrap() with proper error propagation at: chess/src/game.rs:196 (undo), chess/src/game.rs:239 (redo), engine/src/uci/parser.rs:154 (char parse). Each is guarded but inconsistent with ?-style used elsewhere. Files: chess/src/game.rs, engine/src/uci/parser.rs. Complexity: Small.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:40Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:40Z","dependencies":[{"issue_id":"ct-4iv","depends_on_id":"ct-2l2","type":"blocks","created_at":"2026-02-23T19:10:58Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-4os","title":"CHANGELOG generation with git-cliff","description":"Set up automated CHANGELOG generation from conventional commits.\n\n## What\n- Add cliff.toml configuration\n- Integrate with cargo-release so CHANGELOG.md is updated before version commit\n- Optionally integrate with cargo-dist to include changelog in GitHub Release notes\n\n## Why\n- Provides structured release notes for users\n- Conventional commit messages already used in this repo\n- git-cliff is the standard tool in the Rust ecosystem\n\nPart of epic ct-gob","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T21:25:26Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T21:25:26Z"}
{"id":"ct-4th","title":"Set up cargo-dist for automated release builds","description":"Replace manual cross-platform release workflow with cargo-dist. Supersedes ct-ue2 and ct-d7a.\n\n## What\n- Run cargo dist init to generate .github/workflows/release.yml\n- Configure workspace.metadata.dist in Cargo.toml or dist-workspace.toml\n- Targets: aarch64-apple-darwin, x86_64-apple-darwin (macOS only for now)\n- Installers: shell (curl | sh)\n- pr-run-mode: upload (test builds on PRs)\n\n## Why cargo-dist over manual workflow\n- ~15 lines of TOML replaces ~200 lines of manual YAML\n- Handles archive packaging, checksum generation, GitHub Release creation automatically\n- Adding platforms later = adding target strings to config\n- Shell installer generated automatically\n- cargo-binstall compatibility for free\n\n## Signing\n- Ad-hoc codesigning is sufficient for CLI tools distributed via Homebrew or shell installer\n- No Apple Developer account needed for now\n- cargo-dist handles ad-hoc signing automatically\n\nPart of epic ct-gob","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T21:25:09Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T21:25:09Z","dependencies":[{"issue_id":"ct-4th","depends_on_id":"ct-0au","type":"blocks","created_at":"2026-02-23T21:25:34Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-4th","depends_on_id":"ct-44u","type":"blocks","created_at":"2026-02-23T21:25:35Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-50d52ab1","title":"Implement Pin detector","description":"Rework the existing pin detection from detect_pins_and_skewers() (tactics.rs:173-214) into a standalone detector implementing TacticalDetector.\n\nAlgorithm:\n- For each sliding piece (bishop/rook/queen) of the side who just moved:\n  - For each direction: ray trace until hitting piece A\n  - Continue ray; if next piece B exists and B is higher value (king = absolute pin, queen/rook = relative pin)\n  - If A belongs to opponent and B belongs to opponent → pin exists\n- Emit TacticalTag { kind: Pin, attacker: pinner square, victims: [pinned piece square], target_square: pinned_to square, confidence (1.0 if pinned to king, 0.8 otherwise), evidence with TacticalLine }\n\nCan also use AttackMap.pins() if pre-computed during AttackMap construction.\n\nImprovement over current: confidence scoring, evidence lines, uses AttackMap for consistency.\n\nDepends on: ct-ba75d59f (TacticalDetector trait), ct-9f92e422 (AttackMap).","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:44:46Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T15:42:20Z","closed_at":"2026-02-22T15:42:20Z","close_reason":"Implemented PinDetector in pin_detector.rs using AttackMap.pins(). Absolute pins (to king) get confidence 1.0, relative pins get 0.8. Evidence lines trace the full ray. 5 tests passing.","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-50d52ab1","depends_on_id":"ct-9f92e422","type":"blocks","created_at":"2026-02-21T23:46:33Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-50d52ab1","depends_on_id":"ct-ba75d59f","type":"blocks","created_at":"2026-02-21T23:46:33Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-50d52ab1","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:07Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-51018430","title":"Implement MateThreat detector (heuristic)","description":"NEW heuristic detector for mate threats.\n\nAlgorithm:\n- Primary: check if eval_after shows mate score (Mate(N) for small N) — confidence 1.0\n- Secondary: check if the PV line ends in checkmate within 3-5 moves — confidence 0.8\n- Geometric heuristic: after the played move, check if the opponent's king has limited escape squares AND our pieces threaten the king zone — confidence 0.4-0.6\n\nEmit TacticalTag { kind: MateThreat, attacker: key attacking piece, victims: [king square], confidence, note: 'Mate in N' or 'Mate threat', evidence }\n\nThis is semi-heuristic: engine eval provides high-confidence signals, geometry provides lower-confidence ones.\n\nDepends on: ct-ba75d59f (TacticalDetector trait), ct-9f92e422 (AttackMap).","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:45:12Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T16:17:44Z","closed_at":"2026-02-22T16:17:44Z","close_reason":"Implemented all 9 tactical detectors and reducer: skewer, fork+double_attack, hanging_piece, back_rank, discovered_attack, sacrifice, zwischenzug, mate_threat, and reducer. 63 tests pass, clippy clean.","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-51018430","depends_on_id":"ct-9f92e422","type":"blocks","created_at":"2026-02-21T23:46:36Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-51018430","depends_on_id":"ct-ba75d59f","type":"blocks","created_at":"2026-02-21T23:46:36Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-51018430","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:09Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-52c","title":"Update justfile with dev socket/PID paths","description":"The config module uses /tmp for socket and PID paths by default, but in development we should use repo-relative paths for easier debugging. Update the justfile to set CHESSTTY_SOCKET_PATH and CHESSTTY_PID_PATH environment variables (similar to existing CHESSTTY_DATA_DIR and CHESSTTY_DB_PATH).","status":"closed","priority":2,"issue_type":"chore","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T15:48:36Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T15:49:44Z","closed_at":"2026-02-23T15:49:44Z","close_reason":"Updated justfile with CHESSTTY_SOCKET_PATH and CHESSTTY_PID_PATH environment variables pointing to data/ directory"}
{"id":"ct-5bt","title":"Implement async traits on existing JSON stores","description":"Add async trait implementations for all 5 existing JSON stores (SessionStore, PositionStore, FinishedGameStore, ReviewStore, AdvancedAnalysisStore). The sync file I/O is fast enough for single records that spawn_blocking is not needed for this fallback path. All existing tests must continue to pass.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:23:21Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T10:18:57Z","closed_at":"2026-02-22T10:18:57Z","close_reason":"Database module with pool/migrations/tests created. All 5 JSON stores implement async repository traits. cargo check passes.","dependencies":[{"issue_id":"ct-5bt","depends_on_id":"ct-nxo","type":"blocks","created_at":"2026-02-22T00:25:46Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-5i6","title":"Create shared common crate with config","description":"Create a new common crate (common/Cargo.toml, common/src/lib.rs) exporting get_socket_path() -\u003e PathBuf. Add to workspace members in root Cargo.toml. This eliminates 5 duplicate copies of the same function. Files: new common/Cargo.toml, common/src/lib.rs, root Cargo.toml. Complexity: Small.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:07Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:07Z"}
{"id":"ct-600","title":"Remove handle_tab_navigation function and related cycling infrastructure","description":"Delete the handle_tab_navigation function (input.rs:52-73) since it is no longer called. In UiStateMachine (fsm/mod.rs), remove or deprecate the cycling methods that are no longer needed: tab_order(), visible_selectable_components(), next_component(), prev_component(), first_component(). Keep section-based navigation (next_in_section, prev_in_section, next_section, prev_section) as those are still used by arrow keys in the component-selected context.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:07:29Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T01:08:15Z","closed_at":"2026-02-22T01:08:15Z","close_reason":"Removed handle_tab_navigation dead code from input.rs","labels":["cleanup"],"dependencies":[{"issue_id":"ct-600","depends_on_id":"ct-f3a","type":"blocks","created_at":"2026-02-22T00:07:53Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-600","depends_on_id":"ct-k7e","type":"blocks","created_at":"2026-02-22T00:07:52Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-66af127a","title":"Comprehensive FEN-based unit tests for all detectors","description":"Write thorough unit tests for every detector module in analysis/src/board_analysis/.\n\nFor each detector, create tests with known FEN positions:\n- Fork: knight fork king+rook, pawn fork two minors, queen fork (negative: no fork when only 1 target)\n- Pin: absolute pin (to king), relative pin (to queen), bishop pin, rook pin (negative: no pin through own piece)\n- Skewer: king skewer, queen-rook skewer (negative: front piece less valuable = pin not skewer)\n- DiscoveredAttack: bishop revealed by knight move, rook revealed by bishop move (negative: blocker not on ray)\n- HangingPiece: undefended knight, outnumbered rook (negative: defended piece, pawn excluded)\n- BackRankWeakness: classic back rank with pawns blocking (negative: escape square available)\n- Zwischenzug: intermediate check during exchange (needs eval mock data)\n- MateThreat: mate-in-2 position (needs eval mock), geometric near-mate\n- Sacrifice: piece sac with eval improvement (needs eval mock)\n- DoubleAttack: queen attacking two pieces (not knight = no fork tag)\n\nAlso test the reducer: overlapping Fork+DoubleAttack deduplication, confidence cap, max tags per ply.\n\nTest the full pipeline: detect_tactics() end-to-end with known positions.\n\nDepends on: all detector tasks, pipeline orchestrator task.","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:45:59Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T17:09:21Z","closed_at":"2026-02-22T17:09:21Z","close_reason":"Work completed: all compilation errors fixed, 136 server tests + 89 analysis tests passing","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-66af127a","depends_on_id":"ct-3ff69e18","type":"blocks","created_at":"2026-02-21T23:46:47Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-66af127a","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:11Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-6b2922a1","title":"Update compute_advanced_analysis to use new tactical pipeline","description":"Refactor server/src/review/advanced/compute.rs to call the new detect_tactics() pipeline instead of the old analyze_tactics(), and migrate the SQLite persistence layer.\n\n## Compute Pipeline Changes\n\nCurrent code (compute.rs:42-57):\n- Calls analyze_tactics(\u0026board, color) separately for before/after positions\n- Stores TacticalAnalysis in AdvancedPositionAnalysis.tactics_before / tactics_after\n\nNew approach:\n- Call detect_tactics(board_before, board_after, played_move, eval_before, eval_after, pv) once per ply\n- The pipeline handles both positions internally\n- Store Vec\u003cTacticalTag\u003e instead of TacticalAnalysis\n- Update AdvancedPositionAnalysis to hold Vec\u003cTacticalTag\u003e (or a new wrapper) instead of two TacticalAnalysis fields\n- Pass the played move (parse from PositionReview) and eval data from the engine phase\n\nAlso update empty_tactical_analysis() helper and is_critical_position() in critical.rs — it currently uses !tactics.patterns.is_empty() as a signal; adapt to use Vec\u003cTacticalTag\u003e::is_empty() instead.\n\n## SQLite Schema Migration (advanced_repo.rs)\n\n### Decision: JSON columns (evidence-based)\n\nAll SQL queries against advanced_position_analyses are batch-by-game_id. The current 12 flat count columns (fork_count, pin_count, etc.) and 2 JSON pattern columns are never filtered or aggregated at the SQL level. A normalized tactical_tags table would add JOIN overhead with zero query benefit for a single-user desktop app. JSON columns align with the actual access pattern.\n\n### Migration plan:\n\n1. Drop the 14 existing tactics columns:\n   - tactics_before_fork_count, _pin_count, _skewer_count, _discovered_attack_count, _hanging_piece_count, _has_back_rank_weakness (×2 for before/after)\n   - tactics_before_patterns, tactics_after_patterns\n\n2. Add 2 JSON columns:\n   - tactics_before TEXT NOT NULL DEFAULT '[]'\n   - tactics_after TEXT NOT NULL DEFAULT '[]'\n   Each stores serde_json::to_string(\u0026Vec\u003cTacticalTag\u003e).\n\n3. Update advanced_repo.rs:\n   - insert_position(): serialize Vec\u003cTacticalTag\u003e as JSON for the two columns\n   - PositionRow: replace 14 fields with 2 String fields (tactics_before_json, tactics_after_json)\n   - into_domain(): deserialize Vec\u003cTacticalTag\u003e from JSON strings\n   - Remove the TacticalAnalysis/TacticalPattern imports, add TacticalTag import\n\n4. Update schema.sql with the new column definitions.\n\n5. No backward-compatible migration needed — existing analysis data does not need to be preserved.\n\n### Design note on before/after split:\n\nThe before/after split is inherited from the old model. Consider whether the new pipeline should use a single Vec\u003cTacticalTag\u003e per position where each tag knows whether it pertains to the pre-move or post-move state (via a field like phase: TacticalPhase). This is a design decision to make during implementation — the storage supports either approach (2 JSON columns or 1).\n\nDepends on: pipeline orchestrator task, ct-2f00bfc6 (data model).","notes":"Schema bootstrap complete in ct-fch: sqlite now has tactics_before_tags/tactics_after_tags columns (JSON). This task should write real TacticalTag payloads to those columns during compute migration; legacy counters/patterns can be removed in a subsequent cleanup migration after full rollout.","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:45:34Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T17:09:21Z","closed_at":"2026-02-22T17:09:21Z","close_reason":"Work completed: all compilation errors fixed, 136 server tests + 89 analysis tests passing","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-6b2922a1","depends_on_id":"ct-2f00bfc6","type":"blocks","created_at":"2026-02-21T23:46:45Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-6b2922a1","depends_on_id":"ct-3ff69e18","type":"blocks","created_at":"2026-02-21T23:46:45Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-6b2922a1","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:10Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-6hx","title":"API Surface Cleanup","description":"Expand ChessService trait from 8/28 RPCs to full coverage. Fix set_engine signature mismatch (u8 vs u32, Option). Add proto crate to workspace members. Consider reducing ChessServiceImpl 5-arity generic.","status":"open","priority":2,"issue_type":"feature","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:22Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:32Z","dependencies":[{"issue_id":"ct-6hx","depends_on_id":"ct-47s","type":"blocks","created_at":"2026-02-23T19:08:32Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-75z","title":"Stop leaking cozy_chess::GameStatus through public API","description":"SessionSnapshot at server/src/session/snapshot.rs:8 exposes cozy_chess::GameStatus directly, coupling all consumers to an external library. Introduce chess::GameStatus wrapper enum that maps from cozy_chess at the boundary. Files: chess/src/ (new enum), server/src/session/snapshot.rs, all snapshot consumers. Complexity: Medium.","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:10:10Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:10Z"}
{"id":"ct-7d991545","title":"Update TUI rendering for new TacticalTag format","description":"Update client-tui widgets to render the new TacticalTag format.\n\nFiles to update:\n- client-tui/src/ui/widgets/move_analysis_panel.rs — renders per-ply inline tactics\n- client-tui/src/ui/widgets/advanced_analysis_panel.rs — renders game-wide tactical detail\n- client-tui/src/ui/widgets/board_overlay.rs — renders tactical arrows/highlights on board\n- client-tui/src/ui/widgets/review_tabs_panel.rs — tactical tab content\n\nChanges:\n- Replace TacticalPattern variant matching with TacticalTagKind matching\n- Use TacticalTag.attacker/victims/target_square for arrow/highlight rendering\n- Display confidence as percentage or bar\n- Show TacticalTag.note as tooltip/detail text\n- Handle new tag kinds: DoubleAttack, Sacrifice, Zwischenzug, MateThreat\n- Use confidence to color-code or dim low-confidence tags\n\nDepends on: proto update task.","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:45:50Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T17:25:53Z","closed_at":"2026-02-22T17:25:53Z","close_reason":"All 4 TUI widget files updated to use new TacticalTagProto","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-7d991545","depends_on_id":"ct-d2c7bd3f","type":"blocks","created_at":"2026-02-21T23:46:47Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-7d991545","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:11Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-7fo","title":"Architectural Improvements","description":"Larger structural improvements: stop leaking cozy_chess types through public API, introduce persistence DTOs, decompose SessionState into focused sub-structs, clarify UCI protocol ownership, deduplicate SQLite repo boilerplate.","status":"open","priority":3,"issue_type":"feature","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:25Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:33Z","dependencies":[{"issue_id":"ct-7fo","depends_on_id":"ct-47s","type":"blocks","created_at":"2026-02-23T19:08:33Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-7oh","title":"Wire outline rendering into BoardWidget render loop","description":"BoardWidget::render() at board.rs:165-233 iterates over all 64 squares but only checks square_tint() for background color. It never calls square_outline() and never calls draw_square_outline(). The outline rendering function at board.rs:468-521 is fully implemented with proper box-drawing characters but is dead code. Fix: After piece rendering in the square loop (after line 218), add outline check and draw call. This unblocks ALL outline features (best-move outlines, typeahead outlines, destination outlines).","status":"closed","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T16:43:58Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T11:12:27Z","closed_at":"2026-02-23T11:12:27Z","close_reason":"Wired outline rendering into BoardWidget::render() loop - now calls square_outline() and draw_square_outline() after piece rendering"}
{"id":"ct-7vd","title":"Expand ChessService trait to cover all gRPC operations","description":"ChessService trait covers only 8/28 RPCs. MockChessService can't mock review/persistence calls, making 17 operations in client-tui untestable. Add missing RPCs: undo_move, redo_move, reset_game, stop_engine, suspend/resume/delete_session, save_snapshot, save/list/delete_position, list_finished_games, enqueue_review, get_review_status, get_game_review, export_review_pgn, delete_finished_game, get_advanced_analysis. Files: chess-client/src/traits.rs, chess-client/src/client.rs, mock.rs. Complexity: Large.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:51Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:51Z"}
{"id":"ct-7wm","title":"Implement SqliteSessionRepository","description":"Create server/src/persistence/sqlite/session_repo.rs. Implements SessionRepository trait using sqlx queries against suspended_sessions table. Methods: save (INSERT OR REPLACE), load (SELECT by id), list (ORDER BY created_at DESC), delete. Add unit tests with in-memory DB.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:23:47Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T10:40:38Z","closed_at":"2026-02-22T10:40:38Z","close_reason":"All 5 SQLite repos implemented and passing 39 tests","dependencies":[{"issue_id":"ct-7wm","depends_on_id":"ct-0cb","type":"blocks","created_at":"2026-02-22T00:25:54Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-7wm","depends_on_id":"ct-nxo","type":"blocks","created_at":"2026-02-22T00:25:55Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-8qe","title":"Unify UciDirection enum","description":"UciDirection is defined identically in server/src/session/events.rs:27 and client-tui/src/state.rs:126. Move canonical definition to chess/src/uci.rs (chess crate already owns UCI concepts). Both server and client-tui depend on chess. Files: chess/src/uci.rs, server/src/session/events.rs, client-tui/src/state.rs. Complexity: Small.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:21Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:21Z"}
{"id":"ct-8rz","title":"CI: Security audit workflow","description":"Create a GitHub Actions workflow for dependency security auditing.\n\n## Workflow: .github/workflows/ci-audit.yml\n\n### Option A: cargo-audit (simple)\n1. Install cargo-audit\n2. Run `cargo audit` against RustSec advisory database\n\n### Option B: cargo-deny (comprehensive — recommended)\n1. Create deny.toml configuration:\n   - advisories: check for known vulnerabilities (deny)\n   - licenses: allowlist approved licenses (MIT, Apache-2.0, BSD-2/3-Clause, ISC, Unicode-DFS-2016, Zlib)\n   - bans: deny duplicate versions of critical crates, deny specific unwanted crates\n   - sources: only allow crates.io\n2. Run `cargo deny check`\n\n### Triggers\n- Push to master, pull_request to master\n- Scheduled: weekly (cron: '0 0 * * 1') to catch new advisories\n\n### Notes\n- cargo-deny is more comprehensive (licenses + advisories + bans + sources)\n- Use EmbarkStudios/cargo-deny-action@v1 for easy integration\n- Advisory database updates regularly so scheduled runs catch new CVEs","notes":"Part of epic ct-gob","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T18:12:00Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T18:12:39Z"}
{"id":"ct-94u","title":"Consolidate SessionError::Internal map_err pattern","description":"Replace 4 identical .map_err(|e| SessionError::Internal(e.to_string())) chains in session/actor.rs and session/state.rs with helper fn internal_err\u003cE: ToString\u003e(e: E) -\u003e SessionError or a From impl. Files: server/src/session/actor.rs, server/src/session/state.rs. Complexity: Small.","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:50Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:50Z"}
{"id":"ct-9db898a6","title":"Implement merge/dedupe/rank reducer","description":"Create the Phase C reducer in analysis/src/board_analysis/reducer.rs (new file).\n\nFunction: reduce_tags(tags: Vec\u003cTacticalTag\u003e, max_per_ply: usize) -\u003e Vec\u003cTacticalTag\u003e\n\nLogic:\n1. Merge tags with same attacker+victims (keep higher confidence)\n2. Dedupe overlapping: if Fork exists, suppress generic DoubleAttack for same squares\n3. Rank by confidence descending\n4. Cap to max_per_ply (default 3) highest-confidence tags\n5. Prefer tags associated with the played move's destination square (boost priority)\n\nQuality rules to encode:\n- Only keep tags involving check, capture, high-value piece, king, or large eval swing\n- Tags below a confidence floor (e.g. 0.1) are dropped\n\nDepends on: ct-2f00bfc6 (TacticalTag model).","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:44:25Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T16:17:44Z","closed_at":"2026-02-22T16:17:44Z","close_reason":"Implemented all 9 tactical detectors and reducer: skewer, fork+double_attack, hanging_piece, back_rank, discovered_attack, sacrifice, zwischenzug, mate_threat, and reducer. 63 tests pass, clippy clean.","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-9db898a6","depends_on_id":"ct-2f00bfc6","type":"blocks","created_at":"2026-02-21T23:46:28Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-9db898a6","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:06Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-9f92e422","title":"Build AttackMap infrastructure","description":"Create a reusable pre-computed AttackMap structure in analysis/src/board_analysis/attack_map.rs (new file).\n\nStructs:\n- Attacker { from: Square, piece: Piece }\n- PinInfo { pinner: Square, pinned: Square, pinned_to: Square, ray: Vec\u003cSquare\u003e }\n- AttackMap { attacked_by_white: per-square attacker lists, attacked_by_black: per-square attacker lists, pins: Vec\u003cPinInfo\u003e }\n\nUse SmallVec\u003c[Attacker; 4]\u003e for per-square attacker lists (most squares have few attackers).\n\nProvide methods:\n- AttackMap::compute(board: \u0026Board) -\u003e AttackMap  (build from scratch)\n- attackers_of(\u0026self, sq: Square, color: Color) -\u003e \u0026[Attacker]\n- is_attacked(\u0026self, sq: Square, color: Color) -\u003e bool\n- pins(\u0026self) -\u003e \u0026[PinInfo]\n\nThis replaces ad-hoc calls to helpers::attackers_of() and helpers::attacked_squares() inside detectors. The existing helpers.rs functions remain available for other consumers (king_safety, tension) but detectors should use AttackMap.\n\nDependencies: Add smallvec to analysis/Cargo.toml.","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:44:05Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T15:34:46Z","closed_at":"2026-02-22T15:34:46Z","close_reason":"Implemented AttackMap infra (compute/attackers_of/is_attacked/pins) with tests and smallvec dependency.","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-9f92e422","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:05Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-a29","title":"Align Score/AnalysisScore type hierarchies","description":"engine::Score uses Mate(i8) while chess::AnalysisScore uses Mate(i32). Conversion in server/src/session/actor.rs:331-334 silently truncates (mate distances \u003e127 wrap). Either merge types into single chess::Score with i32, or make engine::Score::Mate use i32. Also delete AnalysisScore::display() method that duplicates its own Display impl. Files: engine/src/lib.rs, chess/src/analysis.rs, server/src/session/actor.rs. Complexity: Medium.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:28Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:28Z"}
{"id":"ct-as5","title":"Remove dead MoveAnalysisPanel widget and helpers","description":"Delete client-tui/src/ui/widgets/move_analysis_panel.rs entirely (struct never constructed, 10 dead helper functions). Remove mod declaration from widgets/mod.rs. Files: move_analysis_panel.rs, widgets/mod.rs. Verify: cargo build -p client-tui.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:47Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:08:47Z"}
{"id":"ct-at6","title":"Add sqlx and directories dependencies","description":"Add sqlx = { version = \"0.8\", features = [\"runtime-tokio\", \"sqlite\"] } and directories = \"6\" to server/Cargo.toml. Verify cargo build succeeds.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:23:16Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T09:48:57Z","closed_at":"2026-02-22T09:48:57Z","close_reason":"Added sqlx 0.8 and directories 6 to server/Cargo.toml, cargo check passes"}
{"id":"ct-b7aac032","title":"Update server-side proto conversions","description":"Update the conversion layer between analysis crate types and proto types in the server.\n\nFiles to update:\n- Any From/Into impls converting TacticalAnalysis → TacticalAnalysisProto\n- Any From/Into impls converting TacticalPattern → TacticalPatternProto\n- Replace with TacticalTag → TacticalTagProto conversions\n- Update AdvancedPositionAnalysis → AdvancedPositionAnalysisProto conversion\n\nSearch for: 'TacticalPatternProto', 'TacticalAnalysisProto', 'SquareInfoProto' in server/ and proto/ to find all conversion points.\n\nDepends on: proto update task, server integration task.","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:45:45Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T17:09:21Z","closed_at":"2026-02-22T17:09:21Z","close_reason":"Work completed: all compilation errors fixed, 136 server tests + 89 analysis tests passing","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-b7aac032","depends_on_id":"ct-6b2922a1","type":"blocks","created_at":"2026-02-21T23:46:47Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-b7aac032","depends_on_id":"ct-d2c7bd3f","type":"blocks","created_at":"2026-02-21T23:46:46Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-b7aac032","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:10Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-ba75d59f","title":"Define TacticalDetector trait and TacticalContext","description":"Create the detector trait framework in analysis/src/board_analysis/detector.rs (new file).\n\nStructs/traits:\n- TacticalContext\u003c'a\u003e { before: \u0026Board, after: \u0026Board, mv: Option\u003cMove\u003e, side_to_move_before: Color, before_attacks: \u0026AttackMap, after_attacks: \u0026AttackMap, eval_before: Option\u003ci32\u003e, eval_after: Option\u003ci32\u003e, best_line: Option\u003cVec\u003cString\u003e\u003e }\n- trait TacticalDetector { fn detect(\u0026self, ctx: \u0026TacticalContext) -\u003e Vec\u003cTacticalTag\u003e; }\n\nThe context carries both positions + attack maps + optional engine info. Each detector is a zero-sized struct implementing the trait. The pipeline calls detect() on each registered detector and collects all tags.\n\nDepends on: ct-2f00bfc6 (TacticalTag model), ct-9f92e422 (AttackMap).","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:44:19Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T15:37:48Z","closed_at":"2026-02-22T15:37:48Z","close_reason":"Created detector.rs with TacticalContext struct and TacticalDetector trait. Wired into mod.rs with pub re-exports. 4 unit tests passing.","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-ba75d59f","depends_on_id":"ct-2f00bfc6","type":"blocks","created_at":"2026-02-21T23:46:27Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-ba75d59f","depends_on_id":"ct-9f92e422","type":"blocks","created_at":"2026-02-21T23:46:28Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-ba75d59f","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:05Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-bd35649a","title":"Implement Fork and DoubleAttack detector","description":"Rework the existing detect_forks() (tactics.rs:127-170) into a standalone detector implementing TacticalDetector.\n\nAlgorithm:\n- Find the moved piece (from ctx.mv) in after position at move.to\n- Compute all squares it attacks via AttackMap\n- Collect attacked enemy pieces among those squares\n- If \u003e= 2 valuable victims (king/queen/rook/minor): emit DoubleAttack\n- If attacker is knight: also emit Fork (higher confidence)\n- Boost confidence if the move is also a check\n\nEmit TacticalTag with: attacker square, victims list, target_square = fork square, confidence (0.7-1.0 depending on piece types), evidence.\n\nImprovement over current: distinguishes Fork vs DoubleAttack, move-relative (uses played move, not just static position), confidence scoring.\n\nDepends on: ct-ba75d59f (TacticalDetector trait), ct-9f92e422 (AttackMap).","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:44:41Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T16:17:44Z","closed_at":"2026-02-22T16:17:44Z","close_reason":"Implemented all 9 tactical detectors and reducer: skewer, fork+double_attack, hanging_piece, back_rank, discovered_attack, sacrifice, zwischenzug, mate_threat, and reducer. 63 tests pass, clippy clean.","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-bd35649a","depends_on_id":"ct-9f92e422","type":"blocks","created_at":"2026-02-21T23:46:33Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-bd35649a","depends_on_id":"ct-ba75d59f","type":"blocks","created_at":"2026-02-21T23:46:32Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-bd35649a","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:07Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-c359e307","title":"Remove legacy TacticalPattern/TacticalAnalysis and clean up","description":"Once all consumers have migrated to the new TacticalTag model:\n\n1. Remove old types from analysis/src/board_analysis/tactics.rs: SquareInfo, TacticalPattern enum, TacticalAnalysis struct, analyze_tactics() function, and all detect_* helper functions\n2. Update analysis/src/board_analysis/mod.rs exports to expose new pipeline API\n3. Remove old proto messages: TacticalPatternProto (oneof), ForkProto, PinProto, SkewerProto, etc., TacticalAnalysisProto\n4. Clean up any remaining references in server/, client-tui/, chess-client/\n5. Update analysis/src/advanced/critical.rs if it references TacticalAnalysis fields (fork_count, pin_count, etc.) — adapt to use Vec\u003cTacticalTag\u003e filtering instead\n\nThis is the final cleanup task after all integration is complete.\n\nDepends on: server integration, proto update, TUI update, server conversions tasks.","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:46:05Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T17:25:53Z","closed_at":"2026-02-22T17:25:53Z","close_reason":"Removed legacy tactics.rs, old proto messages, old DB columns, simplified INSERTs","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-c359e307","depends_on_id":"ct-6b2922a1","type":"blocks","created_at":"2026-02-21T23:46:48Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-c359e307","depends_on_id":"ct-7d991545","type":"blocks","created_at":"2026-02-21T23:46:48Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-c359e307","depends_on_id":"ct-b7aac032","type":"blocks","created_at":"2026-02-21T23:46:49Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-c359e307","depends_on_id":"ct-d2c7bd3f","type":"blocks","created_at":"2026-02-21T23:46:48Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-c359e307","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:11Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-c6bc09e0","title":"Implement HangingPiece detector","description":"Rework the existing detect_hanging_pieces() (tactics.rs:258-282) into a standalone detector implementing TacticalDetector.\n\nAlgorithm (on after position):\n- For each enemy piece square: compute attackers_by_us and defenders_by_them from AttackMap\n- Mark hanging if: defenders empty AND attackers non-empty (confidence: 0.9), OR outnumbered via basic SEE-lite (confidence: 0.6)\n- Emit TacticalTag { kind: HangingPiece, attacker: lowest-value attacker square, victims: [hanging piece square], confidence, evidence with threatened_pieces + defended_by }\n\nCurrent code excludes pawns — keep that (too noisy). Include knights, bishops, rooks, queens.\n\nImprovement over current: add confidence scoring, SEE-lite for outnumbered cases, and evidence fields.\n\nDepends on: ct-ba75d59f (TacticalDetector trait), ct-9f92e422 (AttackMap).","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:44:34Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T16:17:44Z","closed_at":"2026-02-22T16:17:44Z","close_reason":"Implemented all 9 tactical detectors and reducer: skewer, fork+double_attack, hanging_piece, back_rank, discovered_attack, sacrifice, zwischenzug, mate_threat, and reducer. 63 tests pass, clippy clean.","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-c6bc09e0","depends_on_id":"ct-9f92e422","type":"blocks","created_at":"2026-02-21T23:46:32Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-c6bc09e0","depends_on_id":"ct-ba75d59f","type":"blocks","created_at":"2026-02-21T23:46:31Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-c6bc09e0","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:06Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-c8bcb338","title":"Implement Sacrifice detector (heuristic)","description":"NEW heuristic detector for sacrifices.\n\nAlgorithm:\n- The played move captures a piece of lower value (or moves to a square where it's captured) AND leads to significant eval improvement or tactical advantage\n- Detect: piece moved to a square where it's attacked by lower-value enemy pieces AND eval_after is equal or better than eval_before (the material loss is compensated)\n- Also detect: move is a capture where piece_value(captured) \u003c piece_value(capturer) but eval improves\n- Confidence: 0.5-0.8 based on eval swing magnitude\n\nEmit TacticalTag { kind: Sacrifice, attacker: sacrificed piece square, victims: [], target_square: sacrifice square, confidence, note: short explanation, evidence }\n\nRequires eval data for reliable detection. Without eval, skip or use very low confidence.\n\nDepends on: ct-ba75d59f (TacticalDetector trait), ct-9f92e422 (AttackMap).","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:45:17Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T16:17:44Z","closed_at":"2026-02-22T16:17:44Z","close_reason":"Implemented all 9 tactical detectors and reducer: skewer, fork+double_attack, hanging_piece, back_rank, discovered_attack, sacrifice, zwischenzug, mate_threat, and reducer. 63 tests pass, clippy clean.","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-c8bcb338","depends_on_id":"ct-9f92e422","type":"blocks","created_at":"2026-02-21T23:46:37Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-c8bcb338","depends_on_id":"ct-ba75d59f","type":"blocks","created_at":"2026-02-21T23:46:36Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-c8bcb338","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:09Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-c8g","title":"Set up cargo-release for workspace versioning","description":"Configure cargo-release for single-command version bumping across the workspace.\n\n## What\n- Add .cargo/release.toml with shared-version=true, tag-name=v{{version}}, publish=false\n- Workspace version managed in root Cargo.toml (already using workspace.package.version)\n- Tag format: v0.1.0, v0.2.0, etc.\n- Pre-release commit message: chore: release v{{version}}\n\n## Release command\ncargo release patch --execute  # or minor/major\n\nThis bumps all workspace crate versions, creates a commit, tags, and pushes. The tag push triggers the cargo-dist release workflow.\n\nPart of epic ct-gob","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T21:25:04Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T21:25:04Z","dependencies":[{"issue_id":"ct-c8g","depends_on_id":"ct-4th","type":"blocks","created_at":"2026-02-23T21:25:36Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-cbb","title":"Fix set_engine signature mismatch","description":"Trait (chess-client/src/traits.rs:46) uses skill_level: u8, threads: u32, hash_mb: u32. Inherent impl (chess-client/src/client.rs:185) uses skill_level: u32, threads: Option\u003cu32\u003e, hash_mb: Option\u003cu32\u003e. Align to match proto contract. Files: traits.rs, client.rs, all call sites. Complexity: Small.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:51Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:51Z","dependencies":[{"issue_id":"ct-cbb","depends_on_id":"ct-7vd","type":"blocks","created_at":"2026-02-23T19:10:59Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-cbs","title":"Create Homebrew tap and enable Homebrew installer","description":"Set up a Homebrew tap repo and configure cargo-dist to auto-publish formula updates on release.\n\n## What\n- Create homebrew-chesstty GitHub repo with Formula/ directory\n- Add HOMEBREW_TAP_TOKEN secret (GitHub PAT with repo scope) to source repo\n- Add 'homebrew' to installers list in cargo-dist config\n- Configure tap = 'username/homebrew-chesstty' in dist metadata\n\n## User install experience\nbrew tap username/tap\nbrew install username/tap/chesstty\n\n## Multi-binary handling\nBoth chesstty (client) and chesstty-server binaries are bundled in one formula. bin.install is called for each binary.\n\n## Signing\nAd-hoc signing is sufficient for Homebrew distribution on all macOS versions including Sequoia. Homebrew strips quarantine attribute on install.\n\n**NOTE: This task should only be done once the app is production-ready. Defer until chesstty is ready for public distribution.**\n\nPart of epic ct-gob","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T21:25:19Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T21:25:19Z","dependencies":[{"issue_id":"ct-cbs","depends_on_id":"ct-4th","type":"blocks","created_at":"2026-02-23T21:25:35Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-cix","title":"Update widget border rendering to show number-key badge","description":"Each selectable panel widget (InfoPanel, HistoryPanel, EnginePanel, DebugPanel, ReviewSummary, AdvancedAnalysis) renders a title and border. Update the title rendering to include the number key badge when the panel is not selected, e.g. '[1] Game Info' instead of just 'Game Info'. When selected, show the existing '★ ... ★ [SELECTED]' style. This gives users a persistent visual hint of which number selects which panel. Affected files: renderer.rs, game_info_panel.rs, move_history_panel.rs, engine_panel.rs, uci_debug_panel.rs, review_summary_panel.rs, advanced_analysis_panel.rs.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:07:37Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T01:05:37Z","closed_at":"2026-02-22T01:05:37Z","close_reason":"Implemented number-key selection across input handlers, controls bar, and widget borders","labels":["ui"],"dependencies":[{"issue_id":"ct-cix","depends_on_id":"ct-sgc","type":"blocks","created_at":"2026-02-22T00:07:53Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-cjb","title":"Update project documentation","description":"The project documentation has become stale after work on the persitance logic and additional features in the analysis crate. The workspace should be audited and the READMEs updated.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T18:13:38Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T18:37:16Z","closed_at":"2026-02-22T18:37:16Z"}
{"id":"ct-cli","title":"Create chesstty Crate \u0026 CLI Interface","description":"## What\nScaffold the new `chesstty` binary crate that serves as the single entry point for the application. Implement the clap-based CLI with two modes: default (no args) launches server+TUI, and the `engine stop` subcommand signals the server to shut down.\n\n## File(s)\n- `chesstty/chesstty/Cargo.toml` (new)\n- `chesstty/chesstty/src/main.rs` (new)\n- `chesstty/chesstty/src/cli.rs` (new)\n- `Cargo.toml` (add `chesstty` to workspace members)\n\n## Implementation Details\n```rust\nuse clap::{Parser, Subcommand};\n\n#[derive(Parser)]\n#[command(name = \"chesstty\", about = \"Chess TUI with integrated engine analysis\")]\nstruct Cli {\n    #[command(subcommand)]\n    command: Option\u003cCommands\u003e,\n}\n\n#[derive(Subcommand)]\nenum Commands {\n    /// Manage the engine server\n    Engine {\n        #[command(subcommand)]\n        action: EngineAction,\n    },\n}\n\n#[derive(Subcommand)]\nenum EngineAction {\n    /// Stop the background engine server\n    Stop {\n        /// Force immediate shutdown (SIGKILL instead of SIGTERM)\n        #[arg(short, long)]\n        force: bool,\n    },\n}\n```\n\n- Default (None): orchestrate server launch + TUI (implementation in later task)\n- `engine stop`: signal server shutdown (implementation in later task)\n- main.rs: match on cli.command, dispatch to handler stubs\n\n## Dependencies\n- clap = { version = \"4\", features = [\"derive\"] }\n- tokio = { version = \"1.41\", features = [\"full\"] }\n- anyhow = \"1.0\"\n- tracing, tracing-subscriber\n\n## Acceptance Criteria\n- [ ] `chesstty/chesstty/` crate exists with Cargo.toml and src/main.rs\n- [ ] Crate is listed in workspace members in root Cargo.toml\n- [ ] `cargo build -p chesstty` compiles successfully\n- [ ] `cargo run -p chesstty -- --help` shows usage with engine subcommand\n- [ ] `cargo run -p chesstty -- engine stop --help` shows --force flag\n- [ ] Default mode (no args) prints placeholder message\n- [ ] Workspace lints (unsafe_code=forbid, enum_glob_use=deny) apply","status":"closed","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:55:12Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T15:40:34Z","closed_at":"2026-02-23T15:40:34Z","close_reason":"Completed: CLI interface and config module implemented"}
{"id":"ct-cli.1","title":"Scaffold chesstty crate directory and Cargo.toml","description":"Create chesstty/chesstty/ directory. Write Cargo.toml with: name=chesstty, [[bin]] target, dependencies (clap with derive, tokio full, anyhow, tracing, tracing-subscriber). Add 'chesstty' to workspace members in root Cargo.toml. Verify cargo check -p chesstty passes.","status":"closed","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:37Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T15:40:34Z","closed_at":"2026-02-23T15:40:34Z","close_reason":"Completed: CLI interface and config module implemented","dependencies":[{"issue_id":"ct-cli.1","depends_on_id":"ct-cli","type":"parent-child","created_at":"2026-02-21T22:57:37Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-cli.2","title":"Implement clap derive CLI structs","description":"Create src/cli.rs with Cli (Parser), Commands (Subcommand with Option wrapper for default mode), EngineAction (Subcommand with Stop variant), Stop args (-f/--force bool). Follow the exact structure from the parent task description. Export from lib or keep in cli module.","status":"completed","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:38Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T15:40:28Z","dependencies":[{"issue_id":"ct-cli.2","depends_on_id":"ct-cli","type":"parent-child","created_at":"2026-02-21T22:57:37Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-cli.2","depends_on_id":"ct-cli.1","type":"blocks","created_at":"2026-02-21T23:23:13Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-cli.3","title":"Wire CLI dispatch in main.rs","description":"In main.rs: parse Cli, match on command. None =\u003e call launch_default() stub, Some(Commands::Engine { action: EngineAction::Stop { force } }) =\u003e call stop_server() stub. Stubs print messages for now. Set up tracing_subscriber::init().","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:38Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:09Z","dependencies":[{"issue_id":"ct-cli.3","depends_on_id":"ct-cli","type":"parent-child","created_at":"2026-02-21T22:57:37Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-cli.3","depends_on_id":"ct-cli.2","type":"blocks","created_at":"2026-02-21T23:23:13Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-config","title":"Shared Runtime Configuration Module","description":"## What\nCreate a shared configuration module that centralizes all runtime paths and constants used by the shim, server, and client. This ensures the socket path, PID file path, and timeout values are defined once and configurable via environment variables.\n\n## File(s)\n- `chesstty/chesstty/src/config.rs` (new)\n- Alternatively a new shared `chesstty-common` crate, or extend existing `server/src/config.rs`\n\n## Implementation Details\n- Default socket path: `/tmp/chesstty.sock` (override: `CHESSTTY_SOCKET_PATH`)\n- Default PID file path: `/tmp/chesstty.pid` (override: `CHESSTTY_PID_PATH`)\n- Default socket wait timeout: 5 seconds (override: `CHESSTTY_SOCKET_TIMEOUT_SECS`)\n- Default socket wait poll interval: 100ms\n- Follow existing `server/src/config.rs` pattern (env var with fallback to default)\n\n## Acceptance Criteria\n- [ ] Socket path, PID path, and timeout constants are defined with env var overrides\n- [ ] Config is importable from server, client-tui, and the new chesstty shim crate\n- [ ] All values have sensible defaults that work without any env vars set\n- [ ] Existing `server/src/config.rs` pattern (get_data_dir style) is followed","status":"closed","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:54:58Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T15:40:34Z","closed_at":"2026-02-23T15:40:34Z","close_reason":"Completed: CLI interface and config module implemented","labels":["relates_to:ct-083"],"dependencies":[{"issue_id":"ct-config","depends_on_id":"ct-083","type":"blocks","created_at":"2026-02-22T00:53:02Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-config.1","title":"Define path constants with env var overrides","description":"Define SOCKET_PATH, PID_PATH, SOCKET_TIMEOUT_SECS, POLL_INTERVAL_MS as constants. Add env var lookup functions following the get_data_dir() pattern in server/src/config.rs. Each function: check env var -\u003e parse -\u003e fall back to default.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:36Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:20:40Z","dependencies":[{"issue_id":"ct-config.1","depends_on_id":"ct-config","type":"parent-child","created_at":"2026-02-21T22:57:36Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-config.1","depends_on_id":"ct-config.2","type":"blocks","created_at":"2026-02-21T23:23:12Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-config.2","title":"Decide shared config module location","description":"Decision: place config in the chesstty shim crate and re-export, OR create a tiny chesstty-common crate, OR extend server/src/config.rs. Recommended: put in the chesstty shim crate since server and client-tui will depend on it as a library. Document the decision.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:37Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:21:57Z","dependencies":[{"issue_id":"ct-config.2","depends_on_id":"ct-config","type":"parent-child","created_at":"2026-02-21T22:57:36Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-d131eae2","title":"Implement BackRankWeakness detector","description":"Rework the existing detect_back_rank_weakness() (tactics.rs:285-331) into a standalone detector implementing TacticalDetector.\n\nAlgorithm:\n- King on back rank (rank 1 for White, rank 8 for Black)\n- Escape squares blocked by own pawns/pieces\n- Opponent has rook/queen that can potentially deliver mate on back rank\n- Emit even without immediate tactic (low confidence 0.3)\n- Increase confidence to 0.8+ if PV contains back-rank mate pattern or mate score appears in eval\n\nImprovement over current: confidence scoring (was binary), can use engine eval for boosting, evidence fields.\n\nDepends on: ct-ba75d59f (TacticalDetector trait), ct-9f92e422 (AttackMap).","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:45:07Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T16:17:44Z","closed_at":"2026-02-22T16:17:44Z","close_reason":"Implemented all 9 tactical detectors and reducer: skewer, fork+double_attack, hanging_piece, back_rank, discovered_attack, sacrifice, zwischenzug, mate_threat, and reducer. 63 tests pass, clippy clean.","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-d131eae2","depends_on_id":"ct-9f92e422","type":"blocks","created_at":"2026-02-21T23:46:35Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-d131eae2","depends_on_id":"ct-ba75d59f","type":"blocks","created_at":"2026-02-21T23:46:35Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-d131eae2","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:08Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-d2c7bd3f","title":"Update proto definitions for new TacticalTag model","description":"Rewrite proto/proto/advanced_review.proto tactical messages to match the new data model.\n\nReplace:\n- TacticalPatternProto (oneof with 6 variants) → TacticalTagProto\n- TacticalAnalysisProto (flat counts) → repeated TacticalTagProto\n\nNew proto messages:\n- TacticalTagKindProto (enum): FORK, PIN, SKEWER, DISCOVERED_ATTACK, DOUBLE_ATTACK, HANGING_PIECE, SACRIFICE, ZWISCHENZUG, BACK_RANK_WEAKNESS, MATE_THREAT\n- TacticalLineProto { string from, repeated string through, string to }\n- TacticalEvidenceProto { repeated TacticalLineProto lines, repeated string threatened_pieces, repeated string defended_by }\n- TacticalTagProto { TacticalTagKindProto kind, optional string attacker, repeated string victims, optional string target_square, float confidence, optional string note, TacticalEvidenceProto evidence }\n\nUpdate AdvancedPositionAnalysisProto to replace tactics_before/tactics_after with repeated TacticalTagProto tactical_tags.\n\nRun protobuf codegen after changes. Update proto/src/lib.rs conversion code.\n\nDepends on: ct-2f00bfc6 (data model).","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:45:40Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T17:09:21Z","closed_at":"2026-02-22T17:09:21Z","close_reason":"Work completed: all compilation errors fixed, 136 server tests + 89 analysis tests passing","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-d2c7bd3f","depends_on_id":"ct-2f00bfc6","type":"blocks","created_at":"2026-02-21T23:46:46Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-d2c7bd3f","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:10Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-d7a","title":"CD: GitHub Release automation with binary artifacts","description":"Create GitHub Release with uploaded binary artifacts when a version tag is pushed.\n\n## Integration with release build workflow\n\n### Approach\nAdd a release job that depends on all build matrix jobs completing:\n\n1. Download all platform artifacts from the build jobs\n2. Create GitHub Release using softprops/action-gh-release@v2\n3. Attach all platform archives to the release\n4. Auto-generate release notes from commits since last tag\n\n### Release Configuration\n```yaml\n- uses: softprops/action-gh-release@v2\n  with:\n    files: |\n      chesstty-*-x86_64-unknown-linux-gnu.tar.gz\n      chesstty-*-aarch64-unknown-linux-gnu.tar.gz\n      chesstty-*-x86_64-apple-darwin.tar.gz\n      chesstty-*-aarch64-apple-darwin.tar.gz\n    generate_release_notes: true\n    draft: false\n    prerelease: false\n```\n\n### Versioning\n- Tags follow semver: v0.1.0, v0.2.0, etc.\n- Consider using cargo-release or release-plz for automated version bumping\n- Workspace version should be managed in root Cargo.toml\n\n### Notes\n- Depends on cross-platform release build workflow completing\n- Draft releases for pre-release tags (v*-rc*, v*-beta*)\n- Include checksums (SHA256) for each archive","notes":"SUPERSEDED by ct-4th (cargo-dist). cargo-dist handles GitHub Release creation, artifact uploading, and checksum generation automatically.","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T18:12:15Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T21:26:08Z","closed_at":"2026-02-23T21:26:04Z","close_reason":"Closed","dependencies":[{"issue_id":"ct-d7a","depends_on_id":"ct-ue2","type":"blocks","created_at":"2026-02-22T18:12:31Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-d8p","title":"Running shim doesn't start TUI client","description":"The shim CLI main.rs currently just prints 'Starting ChessTTY...' but doesn't actually:\n1. Start the server as a daemon (using the daemon module)\n2. Wait for the socket to be ready (using the wait module)\n3. Spawn the TUI client (client-tui)\n\nThe default (no args) mode should launch the full workflow: daemonize server → wait for socket → launch TUI.","status":"closed","priority":1,"issue_type":"bug","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T17:02:24Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T17:12:02Z","closed_at":"2026-02-23T17:12:02Z","close_reason":"Fixed: shim CLI now checks server, spawns daemon, waits for socket, and launches TUI","dependencies":[{"issue_id":"ct-d8p","depends_on_id":"ct-shim","type":"blocks","created_at":"2026-02-23T17:02:44Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-daemon","title":"Shim Process Management — Daemonize, PID, Socket Wait","description":"## What\nImplement the core process management logic in the chesstty shim: PID file reading/stale detection, a native `Daemon` builder for server daemonization (custom double-fork, builder-pattern API, no external crate), and a socket-ready wait loop with timeout.\n\n## File(s)\n- `chesstty/chesstty/src/process.rs` (new) — PID file operations\n- `chesstty/chesstty/src/daemon.rs` (new) — Daemon builder (double-fork + setsid)\n- `chesstty/chesstty/src/wait.rs` (new) — socket wait loop\n- `chesstty/chesstty/Cargo.toml` — add libc dep\n\n## Implementation Details\n\n### PID File Management (process.rs)\n```rust\npub fn is_server_running(pid_path: \u0026Path) -\u003e bool { ... }  // libc::kill(pid, 0)\npub fn read_pid(pid_path: \u0026Path) -\u003e anyhow::Result\u003ci32\u003e { ... }\npub fn remove_stale_pid(pid_path: \u0026Path) -\u003e anyhow::Result\u003c()\u003e { ... }\n```\n\n### Custom Daemonization — Builder Pattern (daemon.rs)\n```rust\nlet stdout = File::create(\"/tmp/chesstty-server.out\")?;\nlet stderr = File::create(\"/tmp/chesstty-server.err\")?;\n\nDaemon::new()\n    .pid_file(config.pid_path())\n    .working_directory(\"/tmp\")\n    .umask(0o027)\n    .stdout(stdout)\n    .stderr(stderr)\n    .start()?;\n\n// Now in daemon process — start tokio runtime\ntokio::runtime::Runtime::new()?.block_on(server::run())?;\n```\n\nSee subtask 5.2 for full API spec. Every method except `new()` and `start()` is optional.\n\n### Socket Wait Loop (wait.rs)\n```rust\npub async fn wait_for_socket(\n    socket_path: \u0026Path,\n    timeout: Duration,\n    poll_interval: Duration,\n) -\u003e anyhow::Result\u003c()\u003e { ... }\n```\n\nTwo-phase check: file exists AND UnixStream::connect() succeeds.\n\n## Acceptance Criteria\n- [ ] `is_server_running()` correctly detects running vs stale PID\n- [ ] Stale PID files (dead process) are detected and cleaned up\n- [ ] `Daemon` builder API with sensible defaults (see subtask 5.2 for full spec)\n- [ ] Server is daemonized using custom double-fork (no daemonize crate)\n- [ ] Socket wait loop succeeds when server starts within timeout\n- [ ] Socket wait loop fails with clear error message after timeout\n- [ ] Socket wait probes actual connectivity (not just file existence)\n- [ ] All fork/setsid calls BEFORE tokio runtime (sync context only)\n- [ ] All unsafe blocks have // SAFETY comments","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:55:55Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:34Z","dependencies":[{"issue_id":"ct-daemon","depends_on_id":"ct-config","type":"blocks","created_at":"2026-02-21T22:57:55Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-daemon.1","title":"PID file read/write/stale detection","description":"In chesstty/src/process.rs: implement is_server_running(pid_path) using fs::read_to_string + parse i32 + libc::kill(pid, 0). Implement read_pid(pid_path) -\u003e Result\u003ci32\u003e. Implement remove_stale_pid(pid_path) that removes file if process is dead. Handle: file not found, invalid content, permission denied. Mark unsafe blocks with // SAFETY comments.","status":"closed","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:41Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T15:59:02Z","closed_at":"2026-02-23T15:59:02Z","close_reason":"PID file operations implemented in daemon.rs","dependencies":[{"issue_id":"ct-daemon.1","depends_on_id":"ct-config","type":"blocks","created_at":"2026-02-21T23:23:01Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-daemon.1","depends_on_id":"ct-daemon","type":"parent-child","created_at":"2026-02-21T22:57:40Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-daemon.2","title":"Custom Daemon builder (double-fork + setsid, builder pattern)","description":"## What\nImplement a `Daemon` builder struct that encapsulates the UNIX double-fork daemonization pattern. No external crate — we own the implementation. The API mirrors the ergonomics of the `daemonize` crate's builder but is our own code, using `libc` directly.\n\n## File(s)\n- `chesstty/chesstty/src/daemon.rs` (new)\n\n## API Design (Builder Pattern)\n\n```rust\nuse std::path::PathBuf;\nuse std::fs::File;\n\npub struct Daemon {\n    pid_file: Option\u003cPathBuf\u003e,\n    chown_pid_file: bool,\n    working_directory: PathBuf,      // default: \"/\"\n    user: Option\u003cString\u003e,\n    group: Option\u003cGroup\u003e,            // String name or u32 gid\n    umask: u32,                      // default: 0o027\n    stdout: Option\u003cFile\u003e,\n    stderr: Option\u003cFile\u003e,\n    privileged_action: Option\u003cBox\u003cdyn FnOnce() -\u003e anyhow::Result\u003c()\u003e\u003e\u003e,\n}\n\npub enum Group {\n    Name(String),\n    Id(u32),\n}\n\nimpl Daemon {\n    pub fn new() -\u003e Self {\n        Self {\n            pid_file: None,\n            chown_pid_file: false,\n            working_directory: PathBuf::from(\"/\"),\n            user: None,\n            group: None,\n            umask: 0o027,\n            stdout: None,\n            stderr: None,\n            privileged_action: None,\n        }\n    }\n\n    pub fn pid_file(mut self, path: impl Into\u003cPathBuf\u003e) -\u003e Self { self.pid_file = Some(path.into()); self }\n    pub fn chown_pid_file(mut self, chown: bool) -\u003e Self { self.chown_pid_file = chown; self }\n    pub fn working_directory(mut self, path: impl Into\u003cPathBuf\u003e) -\u003e Self { self.working_directory = path.into(); self }\n    pub fn user(mut self, user: impl Into\u003cString\u003e) -\u003e Self { self.user = Some(user.into()); self }\n    pub fn group(mut self, group: impl Into\u003cGroup\u003e) -\u003e Self { self.group = Some(group.into()); self }\n    pub fn umask(mut self, mask: u32) -\u003e Self { self.umask = mask; self }\n    pub fn stdout(mut self, f: File) -\u003e Self { self.stdout = Some(f); self }\n    pub fn stderr(mut self, f: File) -\u003e Self { self.stderr = Some(f); self }\n    pub fn privileged_action\u003cF\u003e(mut self, f: F) -\u003e Self\n    where F: FnOnce() -\u003e anyhow::Result\u003c()\u003e + 'static {\n        self.privileged_action = Some(Box::new(f));\n        self\n    }\n\n    /// Execute the double-fork daemonization sequence.\n    ///\n    /// On success, returns Ok(()) in the daemon (grandchild) process.\n    /// The original caller process exits via std::process::exit(0).\n    ///\n    /// Sequence:\n    /// 1. First fork — parent exits\n    /// 2. setsid() — detach from controlling terminal\n    /// 3. Execute privileged_action (if set) — runs before privilege drop\n    /// 4. Drop privileges (user/group, if set)\n    /// 5. Second fork — session leader exits\n    /// 6. umask + chdir\n    /// 7. Redirect stdin→/dev/null, stdout/stderr→configured files\n    /// 8. Write PID file (grandchild PID)\n    pub fn start(self) -\u003e anyhow::Result\u003c()\u003e { ... }\n}\n```\n\n### Usage in the shim (chesstty/src/daemon.rs caller)\n```rust\nlet stdout = File::create(\"/tmp/chesstty-server.out\")?;\nlet stderr = File::create(\"/tmp/chesstty-server.err\")?;\n\nDaemon::new()\n    .pid_file(config.pid_path())\n    .working_directory(\"/tmp\")\n    .umask(0o027)\n    .stdout(stdout)\n    .stderr(stderr)\n    .start()?;\n\n// We are now the daemon — start tokio runtime and run server\ntokio::runtime::Runtime::new()?.block_on(server::run())?;\n```\n\n### Implementation Notes\n- Reference `daemonize` crate source (https://github.com/knsd/daemonize) for edge cases\n- `impl Into\u003cGroup\u003e` for both `\u0026str`/`String` and `u32` to support `.group(\"daemon\")` and `.group(2)`\n- `privileged_action` runs between setsid and privilege drop — useful for binding sockets that need elevated permissions\n- `chown_pid_file`: if true and user/group set, chown the PID file after writing\n- File descriptor redirection via `libc::dup2()`: stdin→/dev/null, stdout→stdout file, stderr→stderr file\n- If stdout/stderr not configured, redirect to /dev/null\n- Consider closing inherited FDs (3..max_fd) to prevent leaking parent's open files\n- All `unsafe` blocks (fork, setsid, umask, dup2, setuid, setgid) require `// SAFETY:` comments\n- `start()` consumes self (moved, not borrowed) — one-shot operation\n\n### Error Type\nConsider a dedicated `DaemonError` enum (via thiserror) rather than stringly-typed anyhow errors:\n```rust\n#[derive(Debug, thiserror::Error)]\npub enum DaemonError {\n    #[error(\"first fork failed: {0}\")]\n    ForkFailed(std::io::Error),\n    #[error(\"setsid failed: {0}\")]\n    SetsidFailed(std::io::Error),\n    #[error(\"failed to write PID file: {0}\")]\n    PidFile(std::io::Error),\n    #[error(\"privilege drop failed: {0}\")]\n    PrivilegeDrop(std::io::Error),\n    #[error(\"privileged action failed: {0}\")]\n    PrivilegedAction(anyhow::Error),\n    // ...\n}\n```\n\n## Acceptance Criteria\n- [ ] `Daemon` struct with builder-pattern API (all setters return Self)\n- [ ] Every method except `new()` and `start()` is optional with sensible defaults\n- [ ] Double-fork implemented correctly (parent exits, grandchild is daemon)\n- [ ] setsid() detaches from controlling terminal\n- [ ] Second fork prevents re-acquiring controlling terminal\n- [ ] privileged_action runs between setsid and privilege drop\n- [ ] User/group privilege drop via setuid/setgid (when configured)\n- [ ] PID file written with daemon's actual PID (grandchild)\n- [ ] PID file optionally chowned to target user/group\n- [ ] stdin→/dev/null, stdout/stderr→configured files (or /dev/null)\n- [ ] Dedicated DaemonError enum (thiserror), not stringly-typed errors\n- [ ] All unsafe blocks have // SAFETY comments\n- [ ] Works on macOS (darwin) and Linux\n- [ ] No external daemonize crate in dependencies","status":"closed","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:41Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T16:05:48Z","closed_at":"2026-02-23T16:05:48Z","close_reason":"Daemon builder with double-fork, setsid, privilege drop, PID file, IO redirection implemented","dependencies":[{"issue_id":"ct-daemon.2","depends_on_id":"ct-config","type":"blocks","created_at":"2026-02-21T23:23:01Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-daemon.2","depends_on_id":"ct-daemon","type":"parent-child","created_at":"2026-02-21T22:57:40Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-daemon.3","title":"Socket wait/retry loop with timeout","description":"In chesstty/src/wait.rs: implement wait_for_socket(socket_path, timeout, poll_interval) -\u003e Result\u003c()\u003e. Loop: check Instant::now() \u003e deadline -\u003e bail with error, check path.exists() -\u003e try UnixStream::connect() -\u003e return Ok if success, sleep(poll_interval). Two-phase check: file exists AND connection succeeds. Default timeout 5s, poll interval 100ms. Clear error message includes log file path for debugging.","status":"closed","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:41Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T16:17:55Z","closed_at":"2026-02-23T16:17:55Z","close_reason":"Socket wait/retry loop implemented with two-phase check (exists + connect), configurable timeout/poll interval, and default values","dependencies":[{"issue_id":"ct-daemon.3","depends_on_id":"ct-config","type":"blocks","created_at":"2026-02-21T23:23:01Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-daemon.3","depends_on_id":"ct-daemon","type":"parent-child","created_at":"2026-02-21T22:57:41Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-dcm","title":"Remove duplicate format_square/parse_square in client-tui","description":"client-tui reimplements format_square (game_info_panel.rs:462) and parse_uci_square (review_state.rs:234, board_overlay.rs:339) despite chess::converters already exporting them. client-tui already depends on chess. Delete local copies, use chess::format_square/parse_square. Files: board_overlay.rs, game_info_panel.rs, review_state.rs. Complexity: Small.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:31Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:31Z"}
{"id":"ct-dfr","title":"Implement SqliteFinishedGameRepository","description":"Create server/src/persistence/sqlite/finished_game_repo.rs. Implements FinishedGameRepository trait. save() uses transaction: insert game row + batch-insert stored_moves with ply index. load() queries both tables and assembles Vec\u003cStoredMoveRecord\u003e. list() returns games sorted by created_at DESC. delete() relies on CASCADE. Add unit tests.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:23:52Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T10:40:38Z","closed_at":"2026-02-22T10:40:38Z","close_reason":"All 5 SQLite repos implemented and passing 39 tests","dependencies":[{"issue_id":"ct-dfr","depends_on_id":"ct-0cb","type":"blocks","created_at":"2026-02-22T00:25:56Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-dfr","depends_on_id":"ct-nxo","type":"blocks","created_at":"2026-02-22T00:25:56Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-e2b","title":"Dead Code Removal","description":"Remove ~1500 lines of dead code across the workspace. Lowest risk, highest immediate impact. Includes: daemon builder, JSON persistence stores, unused widgets, ReviewUIState, EvalCache, dead FSM infrastructure, MiniBoardWidget, and dead_code audit.","status":"open","priority":1,"issue_type":"feature","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:13Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:29Z","dependencies":[{"issue_id":"ct-e2b","depends_on_id":"ct-47s","type":"blocks","created_at":"2026-02-23T19:08:31Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-e6t","title":"Create sqlite/mod.rs with shared encode/decode helpers","description":"Create server/src/persistence/sqlite/mod.rs with: (1) module re-exports for all sqlite repo types, (2) shared encode/decode helpers: encode_score(AnalysisScore) -\u003e (\u0026str, i32) / decode_score(\u0026str, i32) -\u003e AnalysisScore, encode_status(ReviewStatus) -\u003e (status, current_ply, total_plies, error) / decode_status(...) -\u003e ReviewStatus. Used by ct-rsv (ReviewRepository) and ct-idj (AdvancedAnalysisRepository). Should be created as part of the sqlite module infrastructure.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:52:50Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T10:21:44Z","closed_at":"2026-02-22T10:21:44Z","close_reason":"Helpers module with encode/decode for AnalysisScore, ReviewStatus, MoveClassification, and game_mode normalization. All 4 tests pass.","labels":["relates_to:ct-lx9"],"dependencies":[{"issue_id":"ct-e6t","depends_on_id":"ct-0cb","type":"blocks","created_at":"2026-02-22T00:52:59Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-e73","title":"Refactor SessionManager to generic async repositories","description":"Make server SessionManager generic over SessionRepository, PositionRepository, and FinishedGameRepository traits; convert repository-calling methods to async and update all call sites; verify with cargo check/tests.","notes":"Applied SessionManager generic trait bounds and updated service endpoint call sites to generic async usage. Verification blocked by existing out-of-scope compile errors in server/src/review/worker.rs (Arc\u003cR\u003e/Arc\u003cA\u003e trait bounds), and rust-analyzer unavailable in environment.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T13:15:25Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T13:50:06Z","closed_at":"2026-02-22T13:50:06Z","close_reason":"SessionManager and ReviewManager fully generic over async repository traits. All 136 tests pass, build compiles cleanly."}
{"id":"ct-eim","title":"Persist TacticalTag payloads in SQLite advanced analysis","description":"When compute path is switched to TacticalTag, write real tags into tactics_before_tags/tactics_after_tags in advanced_position_analyses and load/validate them during retrieval and JSON migration import. Coordinate with ct-6b2922a1 and ct-b7aac032.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T15:34:13Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T17:10:15Z","closed_at":"2026-02-22T17:10:15Z","close_reason":"TacticalTag payloads persisted in SQLite: insert_position writes serialized JSON to tactics_before_tags/tactics_after_tags columns, into_domain deserializes back","dependencies":[{"issue_id":"ct-eim","depends_on_id":"ct-6b2922a1","type":"blocks","created_at":"2026-02-22T15:34:13Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-eim","depends_on_id":"ct-b7aac032","type":"blocks","created_at":"2026-02-22T15:34:13Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-f3a","title":"Replace Tab navigation with number-key selection in component-selected context","description":"In handle_component_selected_context (input.rs:496-583), replace the KeyCode::Tab arm (lines 523-533) with number key handlers (1-4) that switch directly to the target panel. This replaces the cycling behavior with direct jumps. Keep arrow-key within-section navigation (j/k) and section-hopping (h/l) as-is since those still make sense for spatial navigation once a panel is selected. Remove the Shift+Tab handling.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:07:25Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T01:05:37Z","closed_at":"2026-02-22T01:05:37Z","close_reason":"Implemented number-key selection across input handlers, controls bar, and widget borders","labels":["refactor"],"dependencies":[{"issue_id":"ct-f3a","depends_on_id":"ct-sgc","type":"blocks","created_at":"2026-02-22T00:07:52Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-f6z","title":"Audit and reorganize review mode panel content","description":"Review mode panels need content reorganization. Currently information is spread across panels without a clear separation of concerns. The goal is:\n\n- **Advanced Analysis panel (tab 3)**: Should display information specific to the currently selected move/position (per-move analysis, move classification, tactical details, position evaluation, etc.)\n- **Review Summary panel (tab 4)**: Should display overall match/game data (aggregate statistics, player performance summary, game-level insights, etc.)\n\nSteps:\n1. Audit what data each review panel currently displays\n2. Identify which data belongs to per-move vs overall-game scope\n3. Move content to the appropriate panel\n4. Update rendering logic accordingly","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T01:20:30Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T01:20:30Z"}
{"id":"ct-f901f2c8","title":"Tactical Pattern Detection Pipeline Rework","description":"Rework tactical detection into a pure-function pipeline: PositionContext → Vec\u003cTacticalTag\u003e. Replace the current flat TacticalPattern enum + TacticalAnalysis with a richer TacticalTag model (kind, attacker, victims, confidence, evidence). Introduce AttackMap as reusable pre-computed structure, a TacticalDetector trait for modular detectors, and a merge/dedupe/rank reducer. Add new detectors: DiscoveredAttack (currently stub), Zwischenzug, MateThreat, Sacrifice, DoubleAttack. Rework existing: Fork, Pin, Skewer, HangingPiece, BackRankWeakness. Update proto/gRPC, server pipeline, and TUI rendering.","notes":"DB persistence tracking update: completed ct-fch for schema bootstrap; added follow-up ct-eim to persist actual TacticalTag payloads once compute/proto migration lands.","status":"closed","priority":3,"issue_type":"feature","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:43:41Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T17:26:08Z","closed_at":"2026-02-22T17:26:08Z","close_reason":"All 20 tasks complete: new TacticalTag pipeline with 10 detectors, proto/gRPC migration, TUI rendering, legacy cleanup with DB migration","labels":["relates_to:ct-lx9","tactical-pipeline"]}
{"id":"ct-fa8f15d7","title":"Implement DiscoveredAttack detector","description":"NEW detector — the current DiscoveredAttack variant exists in TacticalPattern but detect logic was never implemented (discovered_attack_count is always 0).\n\nAlgorithm (move-relative):\n- Compare before_attacks vs after_attacks from AttackMap\n- Look for squares newly attacked by a slider in after that were NOT attacked in before\n- Check if the blocker that moved away is the played piece (ctx.mv.from was on the ray)\n- If the newly attacked square contains an enemy piece (or king) → discovered attack\n- Emit TacticalTag { kind: DiscoveredAttack, attacker: revealed slider square, victims: [target square], target_square: None, confidence 0.8-1.0 (higher if target is king/queen), evidence with TacticalLine from slider through old blocker position to target }\n\nDepends on: ct-ba75d59f (TacticalDetector trait), ct-9f92e422 (AttackMap).","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T23:44:56Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T16:17:44Z","closed_at":"2026-02-22T16:17:44Z","close_reason":"Implemented all 9 tactical detectors and reducer: skewer, fork+double_attack, hanging_piece, back_rank, discovered_attack, sacrifice, zwischenzug, mate_threat, and reducer. 63 tests pass, clippy clean.","labels":["tactical-pipeline"],"dependencies":[{"issue_id":"ct-fa8f15d7","depends_on_id":"ct-9f92e422","type":"blocks","created_at":"2026-02-21T23:46:35Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-fa8f15d7","depends_on_id":"ct-ba75d59f","type":"blocks","created_at":"2026-02-21T23:46:34Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-fa8f15d7","depends_on_id":"ct-f901f2c8","type":"blocks","created_at":"2026-02-21T23:47:08Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-fch","title":"Add SQLite TacticalTag schema columns","description":"Extend advanced_position_analyses with dedicated TacticalTag JSON columns so tactical pipeline migration can persist richer tags without overloading legacy pattern columns. This is part of epic ct-f901f2c8.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T15:34:12Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T15:34:12Z","closed_at":"2026-02-22T15:34:12Z","close_reason":"Implemented: added migration server/migrations/002_add_tactical_tag_columns.sql and updated sqlite write paths to bind new columns."}
{"id":"ct-gob","title":"Epic: Comprehensive CI/CD pipelines with GitHub Actions","description":"Set up comprehensive CI/CD pipelines for the chesstty Rust workspace using GitHub Actions best practices.\n\n## Goals\n- Automated quality gates on every PR and push to master\n- Fast feedback loop with aggressive caching (Swatinem/rust-cache, sccache)\n- Cross-platform release builds (macOS arm64/x86_64, Linux x86_64/aarch64)\n- Automated GitHub releases with binary artifacts on tag push\n- Dependency security auditing and automated updates\n- Code coverage tracking\n\n## Workspace Context\n- 7-crate workspace: proto, chess, engine, analysis, chess-client, client-tui, server\n- 2 binaries: chesstty-server, client-tui\n- Proto compilation via build.rs (tonic-build, 10 .proto files)\n- SQLite database with sqlx migrations\n- External dependency: Stockfish engine (for server integration tests)\n- Workspace lints: unsafe_code=forbid, enum_glob_use=deny\n- Existing justfile with test/build/lint targets\n\n## Pipeline Architecture\n1. **CI Pipeline** (on PR + push to master):\n   - Format check (cargo fmt --check)\n   - Clippy lints (workspace lints enforced)\n   - Build all crates (with proto compilation)\n   - Run all tests (unit + integration)\n   - Security audit (cargo-audit / cargo-deny)\n   - MSRV verification\n\n2. **CD Pipeline** (on tag push v*):\n   - Cross-platform release builds\n   - GitHub Release creation with binary artifacts\n\n3. **Maintenance** (scheduled):\n   - Dependabot for Cargo dependency updates\n   - Periodic security scans","status":"open","priority":2,"issue_type":"feature","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T18:11:36Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T18:11:36Z"}
{"id":"ct-h3p","title":"Make SessionManager generic over repository traits","description":"Refactor SessionManager in server/src/session/mod.rs to be generic: SessionManager\u003cS: SessionRepository, P: PositionRepository, F: FinishedGameRepository\u003e. Convert all store-calling methods to async fn. Update all call sites.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:23:25Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T13:21:26Z","closed_at":"2026-02-22T13:21:26Z","close_reason":"Implementation complete. All 3 tasks done in parallel. cargo check passes (0 errors), cargo test passes (127/127). Combined changes compile together with no conflicts.","dependencies":[{"issue_id":"ct-h3p","depends_on_id":"ct-5bt","type":"blocks","created_at":"2026-02-22T00:25:47Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-h3p","depends_on_id":"ct-nxo","type":"blocks","created_at":"2026-02-22T00:25:46Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-i6v","title":"Type Unification","description":"Merge duplicate type definitions: GameMode (3 definitions, 4 converters), UciDirection (2 definitions), format_uci_move (2 copies), Score/AnalysisScore (parallel hierarchies with i8/i32 truncation risk), format_square/parse_square (3 reimplementations).","status":"open","priority":1,"issue_type":"feature","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:18Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:30Z","dependencies":[{"issue_id":"ct-i6v","depends_on_id":"ct-47s","type":"blocks","created_at":"2026-02-23T19:08:32Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-i81","title":"Design and create SQLite migration schema","description":"Create server/migrations/001_initial_schema.sql with all DDL. 9 STRICT tables with CHECK constraints: suspended_sessions, saved_positions, finished_games, stored_moves, game_reviews, position_reviews, advanced_game_analyses, psychological_profiles (discriminated by color), advanced_position_analyses (wide table with inlined king safety, tension, and tactical analysis -- ~40 columns). Uses O(1) crash recovery pattern (INSERT OR IGNORE for position_reviews). Pragmas: WAL, foreign_keys ON, busy_timeout 5000, synchronous NORMAL. See architect analysis at ~/.claude/plans/zazzy-waddling-narwhal-agent-ad97f5df0824f8f94.md","notes":"TACTICAL REWORK COMPATIBILITY: The tactical pipeline rework (ct-f901f2c8, P3) will replace TacticalAnalysis (6 fixed counts + Vec\u003cTacticalPattern\u003e) with Vec\u003cTacticalTag\u003e (10 kinds, confidence, evidence). This affects the 12 inlined tactical count columns and 2 JSON pattern columns in advanced_position_analyses. Options before implementing this task: (1) Simplify to JSON-only -- remove count columns, store tactics_before/after as JSON only. Forward-compatible, no migration needed later. (2) Keep counts + plan migration -- keep current columns, accept a 002_tactical_rework.sql migration later. (3) Keep counts + add new ones now -- add columns for all 10 new kinds proactively (risky, model not finalized).","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:23:45Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T09:48:58Z","closed_at":"2026-02-22T09:48:58Z","close_reason":"Created server/migrations/001_initial_schema.sql with 9 STRICT tables, validated with sqlite3, hardened with Codex review recommendations","labels":["relates_to:ct-f901f2c8"]}
{"id":"ct-idj","title":"Implement SqliteAdvancedAnalysisRepository","description":"Create server/src/persistence/sqlite/advanced_repo.rs. Implements AdvancedAnalysisRepository trait. save() uses transaction with 3 table inserts: (1) INSERT OR REPLACE advanced_game_analyses header, (2) INSERT 2 rows into psychological_profiles (by color), (3) batch-insert advanced_position_analyses (wide table with inlined king safety ks_white_*/ks_black_*, tension metrics, tactical summary counts, and TacticalPattern as JSON). load() reverses: query 3 tables, reconstruct nested AdvancedPositionAnalysis with TacticalAnalysis, PositionKingSafety, PositionTensionMetrics from column groups. PsychologicalProfile.color derived from DB column. Add unit tests.","notes":"TACTICAL REWORK COMPATIBILITY: The tactical pipeline rework (ct-f901f2c8) will change the TacticalAnalysis model stored in advanced_position_analyses. The repository implementation must handle whichever schema option is chosen for ct-i81. If JSON-only: simpler serialize/deserialize. If inlined counts: column mapping code will need updating when tactical rework lands. See plan file for full options.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:24:01Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T10:40:38Z","closed_at":"2026-02-22T10:40:38Z","close_reason":"All 5 SQLite repos implemented and passing 39 tests","labels":["relates_to:ct-f901f2c8"],"dependencies":[{"issue_id":"ct-idj","depends_on_id":"ct-0cb","type":"blocks","created_at":"2026-02-22T00:25:57Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-idj","depends_on_id":"ct-e6t","type":"blocks","created_at":"2026-02-22T00:52:59Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-idj","depends_on_id":"ct-nxo","type":"blocks","created_at":"2026-02-22T00:25:57Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-idk","title":"Update persistence/mod.rs: declare traits and sqlite modules, add Sqlx error variant","description":"Modify server/src/persistence/mod.rs: (1) declare and re-export traits module, (2) declare sqlite submodule, (3) add Sqlx(#[from] sqlx::Error) variant to PersistenceError. This is prerequisite glue code that must exist before ct-nxo (traits) and ct-0cb (sqlite module) can compile. Currently tracked in plan section 1.3 but had no beads issue.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:52:48Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T09:58:10Z","closed_at":"2026-02-22T09:58:10Z","close_reason":"Changes applied: mod.rs glue code (traits/sqlite modules, Sqlx error variant) and config.rs (get_db_path, get_legacy_data_dir rename, justfile update). cargo check passes.","labels":["relates_to:ct-lx9"],"dependencies":[{"issue_id":"ct-idk","depends_on_id":"ct-at6","type":"blocks","created_at":"2026-02-22T00:52:58Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-ig2","title":"Handle number-key conflicts with existing keybindings","description":"Audit and resolve number-key conflicts: (1) In handle_board_context, KeyCode::Char(c) catch-all (line 234-237) currently pushes digits into input_buffer for algebraic notation — number keys 1-4 for panel selection must take priority over this catch-all when tab_input is NOT active. (2) In handle_component_selected_context, KeyCode::Char('1')/Char('2') are already used for ReviewSummary tab switching (lines 534-539) — these should only apply when ReviewSummary is the selected component, and panel-selection numbers should work otherwise. (3) The 'p' key for pause must remain unaffected.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:07:43Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T01:05:37Z","closed_at":"2026-02-22T01:05:37Z","close_reason":"Implemented number-key selection across input handlers, controls bar, and widget borders","labels":["bug-prevention"],"dependencies":[{"issue_id":"ct-ig2","depends_on_id":"ct-sgc","type":"blocks","created_at":"2026-02-22T00:07:54Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-ivt","title":"Integration and smoke testing","description":"Verify the full pipeline end-to-end: 1) cargo build succeeds 2) All existing tests pass 3) SQLite unit tests pass for all repos 4) Migration test with sample JSON files including path-doubled layout 5) Full flow: create session, play game, finish, enqueue review, verify review completes 6) Manual smoke: start server, play via TUI, suspend/resume, review pipeline, restart and verify persistence","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:24:11Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T13:50:07Z","closed_at":"2026-02-22T13:50:07Z","close_reason":"136 tests passing including 46 SQLite integration tests. Full pipeline verified. Build compiles with 0 errors.","dependencies":[{"issue_id":"ct-ivt","depends_on_id":"ct-0z7","type":"blocks","created_at":"2026-02-22T00:26:03Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-ivt","depends_on_id":"ct-rtd","type":"blocks","created_at":"2026-02-22T00:53:02Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-ixc","title":"Remove dead EvalCache","description":"Delete server/src/review/advanced/cache.rs entirely (EvalCache + CacheEntry, 3 #[allow(dead_code)] suppressions, never wired into compute path). Remove mod cache from advanced/mod.rs. Files: cache.rs, advanced/mod.rs. Verify: cargo build -p chesstty-server.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:51Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:08:51Z"}
{"id":"ct-j2s","title":"CI: Security audit with cargo-deny","description":"Add cargo-deny to CI pipeline for security advisory checking, license compliance, and source registry restrictions.\n\n## What\n- Add deny.toml to repo root with advisory, license, ban, and source policies\n- Add EmbarkStudios/cargo-deny-action@v2 step to CI workflow\n- Run on push to master, PRs, and weekly schedule (Monday 06:00 UTC)\n\n## Why cargo-deny over cargo-audit\n- Covers advisories + licenses + duplicate versions + source restrictions in one pass\n- Actively maintained with better ecosystem momentum\n- Single deny.toml config file\n\n## Configuration\n- Allow: MIT, Apache-2.0, BSD-2/3-Clause, ISC, Unicode-DFS-2016, CC0-1.0\n- Deny: copyleft, unknown registries, unsound code\n- Warn: multiple versions of same crate, unknown git sources\n- Weekly scheduled run catches new RUSTSEC advisories between code changes\n\nPart of epic ct-gob","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T21:24:56Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T21:24:56Z"}
{"id":"ct-k7e","title":"Replace Tab navigation with number-key selection in board context input handler","description":"In handle_board_context (input.rs:152-273), replace the KeyCode::Tab arm (line 202-204) with number key handlers (1-4) that call fsm.select_component() directly. Each number key should look up the Component via the new from_number_key method, verify it is visible, and select it. Same change needed in the ReviewMode branch (line 183-186). Remove the call to handle_tab_navigation from both paths.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:07:22Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T01:05:37Z","closed_at":"2026-02-22T01:05:37Z","close_reason":"Implemented number-key selection across input handlers, controls bar, and widget borders","labels":["refactor"],"dependencies":[{"issue_id":"ct-k7e","depends_on_id":"ct-sgc","type":"blocks","created_at":"2026-02-22T00:07:52Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-l57","title":"CI: Dependabot configuration for Cargo dependencies","description":"Configure Dependabot to automatically create PRs for Cargo dependency updates.\n\n## File: .github/dependabot.yml\n\n```yaml\nversion: 2\nupdates:\n  - package-ecosystem: cargo\n    directory: /\n    schedule:\n      interval: weekly\n      day: monday\n    open-pull-requests-limit: 10\n    reviewers:\n      - benedikt.schnatterbeck\n    labels:\n      - dependencies\n      - automated\n    groups:\n      minor-and-patch:\n        update-types:\n          - minor\n          - patch\n      major:\n        update-types:\n          - major\n\n  - package-ecosystem: github-actions\n    directory: /\n    schedule:\n      interval: weekly\n    labels:\n      - ci\n      - automated\n```\n\n### Configuration Details\n- Group minor/patch updates together to reduce PR noise\n- Keep major updates separate for manual review\n- Also monitor GitHub Actions versions for updates\n- Weekly schedule balances freshness with PR noise\n- Labels help filter and triage automated PRs","notes":"Part of epic ct-gob","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T18:12:20Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T18:12:40Z"}
{"id":"ct-launch","title":"Default Launch Lifecycle — Full Orchestration","description":"## What\nWire up the complete default-mode lifecycle in the chesstty shim: check if server is running → if not, daemonize it → wait for socket → launch TUI in the foreground.\n\n## File(s)\n- `chesstty/chesstty/src/main.rs` — default command handler\n- `chesstty/chesstty/src/launch.rs` (new) — launch orchestration\n\n## Implementation Details\n```rust\npub async fn launch_default() -\u003e anyhow::Result\u003c()\u003e {\n    let config = config::RuntimeConfig::load();\n\n    // 1. Check if server is already running\n    if process::is_server_running(\u0026config.pid_path) {\n        tracing::info!(\"Server already running (PID file: {:?})\", config.pid_path);\n    } else {\n        // 2. Clean up any stale state\n        process::remove_stale_pid(\u0026config.pid_path)?;\n        if config.socket_path.exists() {\n            std::fs::remove_file(\u0026config.socket_path)?;\n        }\n\n        // 3. Daemonize the server\n        tracing::info!(\"Starting server daemon...\");\n        daemon::start_server_daemon(\u0026config)?;\n    }\n\n    // 4. Wait for socket to become ready\n    tracing::info!(\"Waiting for server socket...\");\n    wait::wait_for_socket(\n        \u0026config.socket_path,\n        config.socket_timeout,\n        config.poll_interval,\n    ).await?;\n\n    // 5. Launch TUI in foreground\n    tracing::info!(\"Launching TUI...\");\n    // Either:\n    // a) Call client-tui as a library: client_tui::run_app(config.socket_path).await\n    // b) Exec into the client-tui binary: std::process::Command::new(\"client-tui\")\n    // Prefer (a) for better integration\n    Ok(())\n}\n```\n\n### Decision: Library vs Exec for TUI launch\n**Recommended: Library call.** Import client-tui's run function and call it directly. This avoids PATH issues, version skew, and gives better error propagation. Requires client-tui to expose a public `run_app(socket_path)` function.\n\n### Decision: Daemonize boundary\nThe daemonize call forks the process. The parent (shim) continues to step 4. The child (daemon) starts the tokio runtime and runs the server. The shim must NOT have started a tokio runtime before forking — use `std::process::Command` or `daemonize` in a sync context, then start the async runtime for the wait+TUI phase.\n\n## Acceptance Criteria\n- [ ] `cargo run -p chesstty` (no args) starts server daemon and launches TUI\n- [ ] If server is already running, skips daemon launch and goes straight to TUI\n- [ ] Stale PID/socket files are cleaned up before new server launch\n- [ ] TUI connects to server via UDS after socket is ready\n- [ ] Clear error message if server fails to start within timeout\n- [ ] Server continues running after TUI exits (daemon persists)\n- [ ] Tracing logs show each lifecycle step","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:56:14Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:45Z","dependencies":[{"issue_id":"ct-launch","depends_on_id":"ct-cli","type":"blocks","created_at":"2026-02-21T22:57:56Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch","depends_on_id":"ct-daemon","type":"blocks","created_at":"2026-02-21T22:57:57Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch","depends_on_id":"ct-signal","type":"blocks","created_at":"2026-02-21T22:57:57Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch","depends_on_id":"ct-uds","type":"blocks","created_at":"2026-02-21T22:57:56Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-launch.1","title":"Implement lifecycle orchestration logic","description":"In chesstty/src/launch.rs: implement launch_default() that: 1) load config, 2) check is_server_running, 3) if not running: clean stale files + daemonize server, 4) wait_for_socket, 5) launch TUI. Each step has tracing::info. Error at any step produces actionable message.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:42Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:44Z","dependencies":[{"issue_id":"ct-launch.1","depends_on_id":"ct-cli","type":"blocks","created_at":"2026-02-21T23:23:04Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch.1","depends_on_id":"ct-daemon","type":"blocks","created_at":"2026-02-21T23:23:05Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch.1","depends_on_id":"ct-launch","type":"parent-child","created_at":"2026-02-21T22:57:41Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch.1","depends_on_id":"ct-signal","type":"blocks","created_at":"2026-02-21T23:23:04Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch.1","depends_on_id":"ct-uds","type":"blocks","created_at":"2026-02-21T23:23:04Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-launch.2","title":"Expose client-tui run function as library","description":"Refactor client-tui so its main logic (ui::run_app or equivalent) is callable as a library function that accepts a socket_path parameter. The shim will call this directly rather than exec'ing the client-tui binary. This requires client-tui to have both a bin target (for standalone use) and a lib target. Add client-tui as a dependency of the chesstty shim crate.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:42Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:44Z","dependencies":[{"issue_id":"ct-launch.2","depends_on_id":"ct-cli","type":"blocks","created_at":"2026-02-21T23:23:05Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch.2","depends_on_id":"ct-daemon","type":"blocks","created_at":"2026-02-21T23:23:06Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch.2","depends_on_id":"ct-launch","type":"parent-child","created_at":"2026-02-21T22:57:41Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch.2","depends_on_id":"ct-signal","type":"blocks","created_at":"2026-02-21T23:23:06Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch.2","depends_on_id":"ct-uds","type":"blocks","created_at":"2026-02-21T23:23:05Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-launch.3","title":"Handle daemonize-to-async boundary","description":"The shim has a tricky execution flow: sync (parse CLI) → sync (Daemon::new().start() which forks) → async (wait_for_socket + launch TUI). The daemon child also goes sync → async (create tokio runtime + run server).\n\nDesign main.rs flow:\n1. Parse CLI args (sync, before any fork)\n2. If default mode and server not running:\n   a. Build Daemon with builder pattern:\n      ```rust\n      let stdout = File::create(config.log_path())?;\n      let stderr = stdout.try_clone()?;\n      Daemon::new()\n          .pid_file(config.pid_path())\n          .working_directory(\"/tmp\")\n          .umask(0o027)\n          .stdout(stdout)\n          .stderr(stderr)\n          .start()?;\n      // We are now the daemon — start server\n      let rt = tokio::runtime::Runtime::new()?;\n      rt.block_on(server::run(config.socket_path()))?;\n      return Ok(()); // daemon exits after server stops\n      ```\n   b. The parent process (original shim) continues after Daemon::start() returns via process exit in the fork. But since start() calls exit(0) in the parent, the shim needs to fork BEFORE calling start(), or use a different pattern:\n      - Option A: shim forks a child, child calls Daemon::start(), shim continues\n      - Option B: Daemon::start() returns a DaemonResult enum { Parent | Child } instead of exiting\n      - Option C (recommended): Use std::process::Command to spawn the server binary as a separate process, then daemonize THAT process. Simpler but requires server to be a separate binary (which it already is: chesstty-server).\n\n   **Decision needed**: Will Daemon::start() exit the parent (like daemonize crate), or return a discriminant? If it exits, the shim must fork first to preserve its own continuation. Recommend: Daemon::start() exits parent like the crate does, but the shim spawns a child process first that becomes the daemon. The shim parent waits for socket and launches TUI.\n\n3. Create tokio runtime for shim (after fork decision resolves)\n4. wait_for_socket().await\n5. Launch TUI in foreground\n\nKey constraint: NO tokio runtime may exist before fork(). tokio::main is NOT usable on the top-level main — use explicit Runtime::new() after the fork boundary.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:42Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:44Z","dependencies":[{"issue_id":"ct-launch.3","depends_on_id":"ct-cli","type":"blocks","created_at":"2026-02-21T23:23:06Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch.3","depends_on_id":"ct-daemon","type":"blocks","created_at":"2026-02-21T23:23:07Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch.3","depends_on_id":"ct-launch","type":"parent-child","created_at":"2026-02-21T22:57:42Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch.3","depends_on_id":"ct-signal","type":"blocks","created_at":"2026-02-21T23:23:07Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-launch.3","depends_on_id":"ct-uds","type":"blocks","created_at":"2026-02-21T23:23:07Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-lrd","title":"Error Handling Standardization","description":"Standardize error handling across the workspace. Engine crate uses Result\u003c_, String\u003e while others use thiserror/anyhow. Remove production unwrap() calls. Consolidate repeated map_err patterns.","status":"open","priority":2,"issue_type":"feature","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:19Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:31Z","dependencies":[{"issue_id":"ct-lrd","depends_on_id":"ct-47s","type":"blocks","created_at":"2026-02-23T19:08:32Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-lx9","title":"Migrate persistence from JSON files to SQLite","description":"Replace the current JsonStore\u003cT\u003e one-file-per-record persistence with SQLite using sqlx. Includes async repository traits, normalized tables, directories crate for platform paths, and one-time JSON data migration. See plan at ~/.claude/plans/zazzy-waddling-narwhal.md","status":"closed","priority":1,"issue_type":"feature","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:22:41Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T13:56:30Z","closed_at":"2026-02-22T13:56:30Z","close_reason":"SQLite migration complete. All 21 subtasks closed. 9 STRICT tables, 5 async repo traits, 5 SQLite implementations, JSON-to-SQLite migration, generic managers, 136 tests passing, 0 warnings."}
{"id":"ct-mv0","title":"Remove dead FSM infrastructure","description":"Delete: client-tui/src/ui/fsm/hooks.rs (entire file, trait + 3 structs never constructed), fsm/states/start_screen.rs (StartScreenState never constructed), fsm/states/match_summary.rs (MatchSummaryState never constructed). Remove corresponding mod declarations and re-exports. Audit 7 uncalled UiStateMachine navigation methods (is_board_focused, set_component_visible, tab_order, visible_selectable_components, next_component, prev_component, first_component). Files: 3-4 files in client-tui/src/ui/fsm/. Verify: cargo build -p client-tui.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:55Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:08:55Z"}
{"id":"ct-mx9","title":"Harden shim daemon process logging and add regression test","description":"Current shim fix suppresses server stdio when spawning in background, preventing trace logs from interfering with TUI. Add hardening and tests:\n\n1) Add configurable server log sink (file or /dev/null default) in shim config\n2) Ensure no server stdout/stderr reaches TUI terminal across binary and cargo fallback paths\n3) Add integration regression test for just start-equivalent flow to assert no server trace logs in foreground output\n4) Document runtime behavior and troubleshooting for logs\n\nThis is follow-up hardening under ct-shim epic.","notes":"Implemented: (1) configurable server log sink via CHESSTTY_SERVER_LOG_PATH (default /dev/null), (2) server stdout/stderr redirection applied in both direct binary and cargo fallback spawn paths, (3) regression coverage via unit test test_server_log_stdio_creates_log_file_for_path_sink, (4) runtime smoke validation confirmed no server trace lines in foreground output while shim starts TUI. Also updated README quick-start, troubleshooting, and config docs for UDS + server log sink.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T17:40:08Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T18:35:10Z","closed_at":"2026-02-23T18:35:10Z","close_reason":"Implemented configurable server log sink, redirected server stdout/stderr in all spawn paths, added regression unit coverage for log sink behavior, validated runtime no foreground server trace leakage, and documented shim env/runtime behavior in README.","dependencies":[{"issue_id":"ct-mx9","depends_on_id":"ct-shim","type":"blocks","created_at":"2026-02-23T17:40:16Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-n3k","title":"Introduce persistence DTOs (decouple from domain types)","description":"ReviewRepository directly accepts analysis::GameReview domain types -- a layering violation where persistence depends on analysis. Introduce DTO structs in persistence layer with From/Into conversions at the repository boundary. Files: server/src/persistence/ (new DTOs), repo trait definitions, analysis/ (domain types unchanged). Complexity: Large.","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:10:13Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:13Z","dependencies":[{"issue_id":"ct-n3k","depends_on_id":"ct-11d","type":"blocks","created_at":"2026-02-23T19:11:09Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-n3k","depends_on_id":"ct-29l","type":"blocks","created_at":"2026-02-23T19:11:08Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-ns4","title":"Make ReviewManager generic over repository traits","description":"Refactor ReviewManager in server/src/review/mod.rs to be generic: ReviewManager\u003cF: FinishedGameRepository, R: ReviewRepository, A: AdvancedAnalysisRepository\u003e. Convert methods to async. Update worker.rs function signatures to accept generic repository params. Update all call sites.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:23:27Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T13:21:26Z","closed_at":"2026-02-22T13:21:26Z","close_reason":"Implementation complete. All 3 tasks done in parallel. cargo check passes (0 errors), cargo test passes (127/127). Combined changes compile together with no conflicts.","dependencies":[{"issue_id":"ct-ns4","depends_on_id":"ct-5bt","type":"blocks","created_at":"2026-02-22T00:25:47Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-ns4","depends_on_id":"ct-nxo","type":"blocks","created_at":"2026-02-22T00:25:47Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-nxo","title":"Define async repository traits","description":"Create server/src/persistence/traits.rs with 5 async repository traits: SessionRepository, PositionRepository, FinishedGameRepository, ReviewRepository, AdvancedAnalysisRepository. Each trait has Send + Sync bounds and async fn methods matching the current store APIs. Uses native async fn in traits (Rust 1.93+). Re-export from persistence/mod.rs.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:23:18Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T10:16:21Z","closed_at":"2026-02-22T10:16:21Z","close_reason":"5 async repository traits defined in traits.rs with re-exports from mod.rs. cargo check passes.","dependencies":[{"issue_id":"ct-nxo","depends_on_id":"ct-at6","type":"blocks","created_at":"2026-02-22T00:25:45Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-nxo","depends_on_id":"ct-idk","type":"blocks","created_at":"2026-02-22T00:52:58Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-o54","title":"Add proto crate to workspace members","description":"chess-proto crate at proto/Cargo.toml is NOT in workspace members in root Cargo.toml. Excluded from cargo test/clippy/doc --workspace. One-line fix: add 'proto' to members array. Files: Cargo.toml. Complexity: Small.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:52Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:52Z"}
{"id":"ct-o78","title":"Unify format_uci_move (delete engine duplicate)","description":"format_uci_move exists in chess/src/uci.rs:48 (by value) and engine/src/uci/parser.rs:173 (by reference). Since Move is Copy, delete the engine copy and import from chess::uci. Engine crate already depends on chess. Files: engine/src/uci/parser.rs, engine/src/stockfish.rs. Complexity: Small.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:24Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:24Z"}
{"id":"ct-om5","title":"CI: Dependabot config for Cargo and GitHub Actions","description":"Add .github/dependabot.yml for automated dependency update PRs.\n\n## Configuration\n- Cargo ecosystem: weekly on Monday, grouped minor+patch, 5 PR limit\n- GitHub Actions ecosystem: weekly on Monday, grouped minor+patch\n- Labels: dependencies, rust (cargo) / dependencies, ci (actions)\n\n## Why\n- Catches RUSTSEC advisories within a week\n- Weekly frequency balances security vs merge noise for a binary application\n- Grouping reduces PR count significantly\n\nPart of epic ct-gob","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T21:24:59Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T21:24:59Z"}
{"id":"ct-plp","title":"Consolidate generate_*_id() into shared utility","description":"Replace 3 identical generate_suspended_id/generate_finished_game_id/generate_position_id functions in server/src/persistence/mod.rs:72-96 with a single generate_prefixed_id(prefix: \u0026str) -\u003e String. Only prefix string differs between them. Files: server/src/persistence/mod.rs + all call sites. Complexity: Small.","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:09:13Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:09:13Z","dependencies":[{"issue_id":"ct-plp","depends_on_id":"ct-5i6","type":"blocks","created_at":"2026-02-23T19:10:57Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-q2f","title":"Shared Configuration","description":"Centralize duplicated configuration (get_socket_path duplicated 5x, generate_*_id duplicated 3x). Create a shared common crate to eliminate copy-paste config across chesstty, server, and client-tui crates.","status":"open","priority":2,"issue_type":"feature","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:15Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:29Z","dependencies":[{"issue_id":"ct-q2f","depends_on_id":"ct-47s","type":"blocks","created_at":"2026-02-23T19:08:31Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-r8d","title":"Clean up stale statig references and dead hook code","description":"The statig crate was removed but some remnants remain:\\n1. Stale comment in client-tui/tests/tab_selection_integration_tests.rs:135 - '(no statig wrapper to interfere)' parenthetical should be removed\\n2. client-tui/src/ui/fsm/hooks.rs contains UiTransitionHook trait, LoggingHook, RpcHook, and CompositeHook that are never called - transition_to() in mod.rs doesn't invoke any hooks. This is dead code from the statig era that should be removed.","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T01:03:29Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T01:03:29Z"}
{"id":"ct-rc7","title":"Implement JSON-to-SQLite data migration","description":"Create server/src/persistence/sqlite/migrate_json.rs. Async function that reads existing JSON files via JsonStore load_all() and inserts into SQLite in a single transaction. Must handle path-doubling bug (try sessions/sessions/ then sessions/). Idempotent: skip if data already exists. Preserves JSON files as backup. Returns MigrationReport with counts per table. Logs at INFO level.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:24:04Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T13:21:26Z","closed_at":"2026-02-22T13:21:26Z","close_reason":"Implementation complete. All 3 tasks done in parallel. cargo check passes (0 errors), cargo test passes (127/127). Combined changes compile together with no conflicts.","dependencies":[{"issue_id":"ct-rc7","depends_on_id":"ct-3hc","type":"blocks","created_at":"2026-02-22T00:25:59Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-rc7","depends_on_id":"ct-7wm","type":"blocks","created_at":"2026-02-22T00:25:59Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-rc7","depends_on_id":"ct-dfr","type":"blocks","created_at":"2026-02-22T00:26:00Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-rc7","depends_on_id":"ct-idj","type":"blocks","created_at":"2026-02-22T00:26:00Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-rc7","depends_on_id":"ct-rsv","type":"blocks","created_at":"2026-02-22T00:26:00Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-rsd","title":"Standardize protobuf enums with UNSPECIFIED sentinel pattern","description":"Audit all proto enum definitions and ensure they follow the idiomatic protobuf pattern: every enum must have a _UNSPECIFIED = 0 sentinel variant. The new TacticalTagKindProto already follows this pattern, but existing enums may not. Since nothing is in production, breaking changes are acceptable — update both server-side proto conversions and client-tui deserialization to match. Check all .proto files for enum definitions and ensure consistency.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T16:35:09Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T16:35:09Z"}
{"id":"ct-rsv","title":"Implement SqliteReviewRepository","description":"Create server/src/persistence/sqlite/review_repo.rs. Implements ReviewRepository trait. Uses O(1) crash recovery pattern: save() does INSERT OR REPLACE on game_reviews header + INSERT OR IGNORE on position_reviews (only new ply inserts). This replaces the JSON approach of rewriting the entire file per ply. Handles ReviewStatus and AnalysisScore encoding/decoding with CHECK-constrained columns. pv stored as JSON array. Add unit tests.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:23:58Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T10:40:38Z","closed_at":"2026-02-22T10:40:38Z","close_reason":"All 5 SQLite repos implemented and passing 39 tests","dependencies":[{"issue_id":"ct-rsv","depends_on_id":"ct-0cb","type":"blocks","created_at":"2026-02-22T00:25:56Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-rsv","depends_on_id":"ct-e6t","type":"blocks","created_at":"2026-02-22T00:52:59Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-rsv","depends_on_id":"ct-nxo","type":"blocks","created_at":"2026-02-22T00:25:57Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-rtd","title":"Per-repository SQLite unit tests","description":"Write #[tokio::test] tests for every new SQLite repo using Database::new_in_memory(): save/load roundtrip equality, list ordering (created_at DESC, defaults-first for positions), delete + CASCADE verification, default position protection error, ReviewStatus + AnalysisScore encoding roundtrips, TacticalPattern JSON serialization roundtrip, compound CHECK constraint on game_reviews status invariants.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:52:52Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T10:41:52Z","closed_at":"2026-02-22T10:41:52Z","close_reason":"39 SQLite repo tests already passing across all 5 repos + helpers + database","labels":["relates_to:ct-lx9"],"dependencies":[{"issue_id":"ct-rtd","depends_on_id":"ct-3hc","type":"blocks","created_at":"2026-02-22T00:53:00Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-rtd","depends_on_id":"ct-7wm","type":"blocks","created_at":"2026-02-22T00:53:00Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-rtd","depends_on_id":"ct-dfr","type":"blocks","created_at":"2026-02-22T00:53:01Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-rtd","depends_on_id":"ct-idj","type":"blocks","created_at":"2026-02-22T00:53:01Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-rtd","depends_on_id":"ct-rsv","type":"blocks","created_at":"2026-02-22T00:53:01Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-sgc","title":"Add number-key mapping to Component enum","description":"Added number_key(mode) and from_number_key(key, mode) methods to Component enum. Game mode: 1=InfoPanel, 2=EnginePanel, 3=HistoryPanel, 4=DebugPanel. Review mode: 1=InfoPanel, 2=HistoryPanel, 3=AdvancedAnalysis, 4=ReviewSummary. number_key() is mode-aware since HistoryPanel maps to different keys across modes.","status":"closed","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:07:18Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T01:23:53Z","closed_at":"2026-02-22T01:02:13Z","close_reason":"Added number_key() and from_number_key() methods to Component enum","labels":["refactor"]}
{"id":"ct-shim","title":"Thin Shim CLI — Process Supervisor \u0026 Entry Point","description":"## What\n\nA \"Thin Shim\" CLI binary (`chesstty`) that acts as the single entry point and process supervisor for the chess TUI application. It replaces the current two-terminal workflow (`just server` + `just tui`) with a single command that:\n\n1. **Default mode (no args)**: Launches the gRPC server as a background daemon (if not already running) and then launches the TUI in the foreground.\n2. **`engine stop` subcommand**: Signals the background server to shut down gracefully (SIGTERM) or immediately (`--force` → SIGKILL).\n\nThe shim introduces Unix Domain Socket communication (replacing TCP `[::1]:50051`), PID file tracking, native server daemonization (custom double-fork, no external crate), and a socket-ready wait loop to ensure the TUI doesn't connect before the server is listening.\n\n## Architecture\n\n```\nchesstty (shim)\n  ├── default: check PID → daemonize server (double-fork) → wait for socket → launch TUI\n  └── engine stop [-f]: read PID → SIGTERM/SIGKILL → cleanup\n\nServer: binds /tmp/chesstty.sock, writes /tmp/chesstty.pid, handles SIGTERM\nClient: connects via UDS, configurable socket path\n```\n\n## New Crate\n\n`chesstty/chesstty/` — added to workspace members in root `Cargo.toml`.\n\n## Key Dependencies\n\n- `clap 4` (derive) — CLI argument parsing\n- `libc 0.2` — custom daemonization (fork/setsid), PID checks, signal sending\n- `tokio-stream` (net feature) — UDS listener stream for tonic\n- `hyper-util` + `tower` — UDS connector for tonic client","notes":"Progress: ct-cli (CLI interface), ct-config (config module), ct-cli.1/ct-cli.2 (crate + CLI structs) completed. Remaining: ct-daemon (process mgmt), ct-uds (socket layer).","status":"in_progress","priority":1,"issue_type":"epic","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:54:44Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T15:41:21Z"}
{"id":"ct-signal","title":"Server Signal Handling \u0026 Graceful Shutdown","description":"## What\nAdd SIGTERM and SIGINT signal handling to the server so it shuts down gracefully: stops accepting new requests, completes in-flight RPCs, cleans up Stockfish child processes, removes the PID file and socket file, and exits cleanly.\n\n## File(s)\n- `server/src/main.rs` — wrap serve in tokio::select! with signal handler\n- `server/src/shutdown.rs` (new) — shutdown coordination logic\n- `server/src/session/manager.rs` — ensure SessionManager propagates shutdown to actors\n\n## Implementation Details\n```rust\nuse tokio::signal::unix::{signal, SignalKind};\n\nlet mut sigterm = signal(SignalKind::terminate())?;\nlet mut sigint = signal(SignalKind::interrupt())?;\n\ntokio::select! {\n    result = server.serve_with_incoming(uds_stream) =\u003e {\n        result?;\n    }\n    _ = sigterm.recv() =\u003e {\n        tracing::info!(\"Received SIGTERM, shutting down gracefully\");\n    }\n    _ = sigint.recv() =\u003e {\n        tracing::info!(\"Received SIGINT, shutting down gracefully\");\n    }\n}\n\n// Cleanup sequence:\n// 1. Stop accepting new connections\n// 2. Wait for in-flight RPCs to complete (with timeout)\n// 3. Shut down SessionManager (kills Stockfish subprocesses)\n// 4. Remove PID file\n// 5. Remove socket file\n```\n\nConsider using `tokio::sync::watch` to broadcast shutdown signal to all subsystems. The existing `CleanupGuard` (Drop-based) pattern for sessions should integrate with this.\n\n## Acceptance Criteria\n- [ ] Server handles SIGTERM and shuts down within 5 seconds\n- [ ] Server handles SIGINT (Ctrl+C) and shuts down gracefully\n- [ ] PID file is removed on graceful shutdown\n- [ ] Socket file is removed on graceful shutdown\n- [ ] All Stockfish child processes are terminated on shutdown\n- [ ] In-flight RPCs complete before server exits (with timeout)\n- [ ] Server logs shutdown sequence via tracing","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:55:39Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:20Z","dependencies":[{"issue_id":"ct-signal","depends_on_id":"ct-uds","type":"blocks","created_at":"2026-02-21T22:57:56Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-signal.1","title":"Add tokio signal handlers for SIGTERM and SIGINT","description":"In server main.rs or a new shutdown.rs module: create tokio::signal::unix::signal(SignalKind::terminate()) and signal(SignalKind::interrupt()). Wrap the serve call in tokio::select! { server.serve_with_incoming(stream) =\u003e ..., sigterm.recv() =\u003e log + begin shutdown, sigint.recv() =\u003e log + begin shutdown }. On signal, initiate graceful shutdown.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:39Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:11Z","dependencies":[{"issue_id":"ct-signal.1","depends_on_id":"ct-signal","type":"parent-child","created_at":"2026-02-21T22:57:39Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-signal.1","depends_on_id":"ct-uds","type":"blocks","created_at":"2026-02-21T23:23:00Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-signal.2","title":"Implement shutdown coordination via watch channel","description":"Create a tokio::sync::watch::channel(false) for shutdown signal. On SIGTERM/SIGINT, send true. Pass the watch::Receiver to SessionManager and ReviewManager so they can observe shutdown. Use serve_with_incoming_shutdown() if available, or manually select on the watch channel. Integrate with existing CleanupGuard pattern for session cleanup.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:40Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:14Z","dependencies":[{"issue_id":"ct-signal.2","depends_on_id":"ct-signal","type":"parent-child","created_at":"2026-02-21T22:57:39Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-signal.2","depends_on_id":"ct-uds","type":"blocks","created_at":"2026-02-21T23:23:00Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-signal.3","title":"Add PID and socket file cleanup on shutdown","description":"After graceful shutdown completes (serve returns): remove PID file at config::pid_path() and socket file at config::socket_path(). Use a Drop guard or explicit cleanup function. Log each cleanup step. Handle errors gracefully (file already removed, permission denied).","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:40Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:17Z","dependencies":[{"issue_id":"ct-signal.3","depends_on_id":"ct-signal","type":"parent-child","created_at":"2026-02-21T22:57:40Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-signal.3","depends_on_id":"ct-uds","type":"blocks","created_at":"2026-02-21T23:23:00Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-stop","title":"'engine stop' Subcommand \u0026 Integration Tests","description":"## What\nImplement the `engine stop` subcommand that reads the PID file and sends the appropriate signal to the server. Also add integration tests covering all lifecycle edge cases.\n\n## File(s)\n- `chesstty/chesstty/src/stop.rs` (new) — stop command implementation\n- `chesstty/chesstty/src/main.rs` — wire stop handler to CLI dispatch\n- `chesstty/chesstty/tests/integration.rs` (new) — integration tests\n\n## Implementation Details\n\n### Graceful Stop (default)\n```rust\npub fn stop_server(pid_path: \u0026Path, force: bool) -\u003e anyhow::Result\u003c()\u003e {\n    let pid = process::read_pid(pid_path)?;\n\n    if force {\n        tracing::warn!(\"Force-killing server (PID {pid})\");\n        unsafe { libc::kill(pid, libc::SIGKILL); }\n    } else {\n        tracing::info!(\"Sending SIGTERM to server (PID {pid})\");\n        unsafe { libc::kill(pid, libc::SIGTERM); }\n\n        // Wait for process to exit (poll with timeout)\n        let deadline = Instant::now() + Duration::from_secs(10);\n        while Instant::now() \u003c deadline {\n            if unsafe { libc::kill(pid, 0) } != 0 {\n                tracing::info!(\"Server stopped\");\n                break;\n            }\n            std::thread::sleep(Duration::from_millis(100));\n        }\n\n        // If still running after timeout, warn user\n        if unsafe { libc::kill(pid, 0) } == 0 {\n            tracing::warn!(\"Server did not stop within 10s. Use --force to kill.\");\n            anyhow::bail!(\"Server did not stop gracefully\");\n        }\n    }\n\n    // Clean up stale files\n    process::remove_stale_pid(pid_path)?;\n    let socket_path = config::socket_path();\n    if socket_path.exists() {\n        std::fs::remove_file(\u0026socket_path)?;\n    }\n\n    Ok(())\n}\n```\n\n### Integration Test Scenarios\n1. **Server already running** — default launch skips daemon, connects TUI\n2. **Stale PID file** — dead process, shim cleans up and launches new server\n3. **Socket wait timeout** — server fails to start, shim reports clear error\n4. **Graceful stop** — SIGTERM, server cleans up, files removed\n5. **Force stop** — SIGKILL, shim cleans up stale files\n6. **Double stop** — `engine stop` when server not running → clean error\n7. **No PID file** — `engine stop` with no server → clean error\n\n## Acceptance Criteria\n- [ ] `chesstty engine stop` sends SIGTERM and waits for server exit\n- [ ] `chesstty engine stop --force` sends SIGKILL immediately\n- [ ] Clean error message when no server is running\n- [ ] Clean error message when PID file doesn't exist\n- [ ] Stale PID/socket files are cleaned up after stop\n- [ ] Integration tests cover all 7 scenarios above\n- [ ] `unsafe` blocks for libc::kill are minimal and well-documented","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:56:28Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:46Z","dependencies":[{"issue_id":"ct-stop","depends_on_id":"ct-cli","type":"blocks","created_at":"2026-02-21T22:57:58Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-stop","depends_on_id":"ct-daemon","type":"blocks","created_at":"2026-02-21T22:57:58Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-stop","depends_on_id":"ct-signal","type":"blocks","created_at":"2026-02-21T22:57:58Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-stop.1","title":"Implement graceful stop via SIGTERM","description":"In chesstty/src/stop.rs: read_pid from PID file, send libc::kill(pid, libc::SIGTERM), poll libc::kill(pid, 0) with 10s timeout to confirm exit. On success: remove stale PID/socket files, print confirmation. On timeout: print warning suggesting --force. On no PID file: print 'server is not running'.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:43Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:45Z","dependencies":[{"issue_id":"ct-stop.1","depends_on_id":"ct-cli","type":"blocks","created_at":"2026-02-21T23:23:09Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-stop.1","depends_on_id":"ct-daemon","type":"blocks","created_at":"2026-02-21T23:23:10Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-stop.1","depends_on_id":"ct-signal","type":"blocks","created_at":"2026-02-21T23:23:09Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-stop.1","depends_on_id":"ct-stop","type":"parent-child","created_at":"2026-02-21T22:57:42Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-stop.2","title":"Implement force stop via SIGKILL","description":"When --force flag is set: send libc::kill(pid, libc::SIGKILL) instead of SIGTERM. SIGKILL cannot be caught, so the server won't clean up its own files. The shim must clean up PID file and socket file after SIGKILL. Brief sleep(100ms) after SIGKILL before cleanup.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:43Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:45Z","dependencies":[{"issue_id":"ct-stop.2","depends_on_id":"ct-cli","type":"blocks","created_at":"2026-02-21T23:23:10Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-stop.2","depends_on_id":"ct-daemon","type":"blocks","created_at":"2026-02-21T23:23:11Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-stop.2","depends_on_id":"ct-signal","type":"blocks","created_at":"2026-02-21T23:23:10Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-stop.2","depends_on_id":"ct-stop","type":"parent-child","created_at":"2026-02-21T22:57:43Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-stop.3","title":"Integration test suite for all lifecycle scenarios","description":"In chesstty/tests/integration.rs or tests/ directory: test all scenarios: 1) fresh start (no server) -\u003e launches daemon + TUI connects, 2) server already running -\u003e skips launch, 3) stale PID (dead process) -\u003e cleanup + relaunch, 4) socket timeout -\u003e clear error, 5) graceful stop -\u003e SIGTERM + cleanup, 6) force stop -\u003e SIGKILL + cleanup, 7) stop with no server -\u003e error message, 8) double stop -\u003e idempotent. Use tempdir for PID/socket files in tests. May need #[ignore] for some tests that require actual process forking.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:43Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:46Z","dependencies":[{"issue_id":"ct-stop.3","depends_on_id":"ct-cli","type":"blocks","created_at":"2026-02-21T23:23:11Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-stop.3","depends_on_id":"ct-daemon","type":"blocks","created_at":"2026-02-21T23:23:12Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-stop.3","depends_on_id":"ct-signal","type":"blocks","created_at":"2026-02-21T23:23:12Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-stop.3","depends_on_id":"ct-stop","type":"parent-child","created_at":"2026-02-21T22:57:43Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-tpc","title":"Add Linux targets to cargo-dist","description":"Extend cargo-dist configuration to build Linux binaries in addition to macOS.\n\n## Targets to add\n- x86_64-unknown-linux-gnu\n- aarch64-unknown-linux-gnu\n\n## Notes\n- cargo-dist uses native ARM64 GitHub runners (free) for aarch64-linux — no cross-rs needed\n- Just add the target strings to the targets list in dist config\n- Protoc installation needs to work on Linux runners too (already handled by arduino/setup-protoc)\n\nPart of epic ct-gob","status":"open","priority":4,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T21:25:30Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T21:25:30Z","dependencies":[{"issue_id":"ct-tpc","depends_on_id":"ct-4th","type":"blocks","created_at":"2026-02-23T21:25:36Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-tt2","title":"Enable shell installer via cargo-dist","description":"Enable the shell installer in cargo-dist config so users can install via curl | sh.\n\n## What\n- Add 'shell' to installers list in cargo-dist workspace metadata (likely already done in cargo-dist setup)\n- Verify the generated installer script works on macOS aarch64 and x86_64\n- Document the install command in README\n\n## Install command\ncurl --proto '=https' --tlsv1.2 -LsSf https://github.com/.../chesstty-installer.sh | sh\n\n## Notes\n- The installer auto-detects OS/arch, downloads correct tarball, verifies checksum\n- Installs to ~/.cargo/bin by default\n- This is nearly zero effort once cargo-dist is configured\n\nPart of epic ct-gob","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T21:25:23Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T21:25:23Z","dependencies":[{"issue_id":"ct-tt2","depends_on_id":"ct-4th","type":"blocks","created_at":"2026-02-23T21:25:35Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-uds","title":"Unix Domain Socket Communication Layer","description":"## What\nMigrate server and client from TCP `[::1]:50051` to Unix Domain Socket communication. The server binds a UDS listener, and the client connects via UDS. This is prerequisite for the shim to manage the server as a local daemon.\n\n## File(s)\n- `server/src/main.rs` — replace `.serve(addr)\\ with `.serve_with_incoming(uds_stream)`\n- `server/Cargo.toml` — add tokio-stream dependency\n- `chess-client/src/client.rs` — add UDS connect method using tower connector\n- `chess-client/Cargo.toml` — add hyper-util, tower deps (already has tower 0.5, hyper 1.5)\n- `client-tui/src/main.rs` — update connection to use UDS path\n\n## Implementation Details\n\n### Server UDS Binding\n```rust\nuse tokio::net::UnixListener;\nuse tokio_stream::wrappers::UnixListenerStream;\n\n// Clean up stale socket file\nlet socket_path = config::socket_path();\nif socket_path.exists() {\n    std::fs::remove_file(\u0026socket_path)?;\n}\n\nlet uds = UnixListener::bind(\u0026socket_path)?;\nlet uds_stream = UnixListenerStream::new(uds);\n\nServer::builder()\n    .add_service(ChessServiceServer::new(service))\n    .serve_with_incoming(uds_stream)\n    .await?;\n```\n\n### Client UDS Connection (tonic snippet)\n```rust\nuse hyper_util::rt::TokioIo;\nuse tokio::net::UnixStream;\nuse tonic::transport::{Channel, Endpoint, Uri};\nuse tower::service_fn;\n\nlet channel = Endpoint::try_from(\"http://[::]:50051\")?\n    .connect_with_connector(service_fn(move |_: Uri| {\n        let path = socket_path.clone();\n        async move {\n            Ok::\u003c_, std::io::Error\u003e(TokioIo::new(UnixStream::connect(path).await?))\n        }\n    }))\n    .await?;\nlet client = ChessServiceClient::new(channel);\n```\n\nNote: The Endpoint URI is a dummy — tonic requires it but the connector ignores it.\n\n## Acceptance Criteria\n- [ ] Server binds to UDS at configured socket path (default /tmp/chesstty.sock)\n- [ ] Server removes stale socket file before binding\n- [ ] Client connects to server via UDS (not TCP)\n- [ ] All 25 gRPC RPCs work over UDS (existing tests pass)\n- [ ] Socket file is created with appropriate permissions\n- [ ] `tokio-stream` (net feature) added to server deps\n- [ ] TCP fallback is NOT required (clean migration)","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:55:27Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:08Z","labels":["relates_to:ct-0z7"],"dependencies":[{"issue_id":"ct-uds","depends_on_id":"ct-config","type":"blocks","created_at":"2026-02-21T22:57:55Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-uds.1","title":"Server: Replace TCP bind with UDS listener","description":"In server/src/main.rs: import tokio::net::UnixListener and tokio_stream::wrappers::UnixListenerStream. Replace the .serve(addr.parse()?) call with: remove stale socket file -\u003e UnixListener::bind(socket_path) -\u003e UnixListenerStream::new(uds) -\u003e .serve_with_incoming(uds_stream). Add tokio-stream = { version = \"0.1\", features = [\"net\"] } to server/Cargo.toml. Log the socket path at startup.","status":"closed","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:38Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T16:56:57Z","closed_at":"2026-02-23T16:56:57Z","close_reason":"Implemented UDS listener with tokio::net::UnixListener and tokio_stream::wrappers::UnixListenerStream","dependencies":[{"issue_id":"ct-uds.1","depends_on_id":"ct-config","type":"blocks","created_at":"2026-02-21T23:22:59Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-uds.1","depends_on_id":"ct-uds","type":"parent-child","created_at":"2026-02-21T22:57:38Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-uds.2","title":"Client: Add UDS connector to chess-client","description":"In chess-client/src/client.rs: add a new connect_uds(socket_path: \u0026Path) method (or modify existing connect). Use Endpoint::try_from(\"http://[::]:50051\")?.connect_with_connector(service_fn(...)) pattern with TokioIo\u003cUnixStream\u003e. chess-client already has tower 0.5 and hyper 1.5 deps; add hyper-util for TokioIo. Keep the old TCP connect method for backward compat if needed.","status":"closed","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:39Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T16:38:20Z","closed_at":"2026-02-23T16:38:20Z","close_reason":"Implemented connect_uds() method with hyper-util and tower","dependencies":[{"issue_id":"ct-uds.2","depends_on_id":"ct-config","type":"blocks","created_at":"2026-02-21T23:22:59Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-uds.2","depends_on_id":"ct-uds","type":"parent-child","created_at":"2026-02-21T22:57:38Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-uds.3","title":"Client-tui: Update connection to use UDS path","description":"In client-tui/src/main.rs (or wherever ui::run_app is configured): replace the hardcoded 'http://[::1]:50051' with a call to config::socket_path() and use ChessClient::connect_uds(). The socket path should come from shared config. Consider making run_app accept a socket_path parameter for the library-call pattern from T6.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-21T22:57:39Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-21T23:22:05Z","dependencies":[{"issue_id":"ct-uds.3","depends_on_id":"ct-config","type":"blocks","created_at":"2026-02-21T23:22:59Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-uds.3","depends_on_id":"ct-uds","type":"parent-child","created_at":"2026-02-21T22:57:39Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-ue2","title":"CD: Cross-platform release build workflow","description":"Create a GitHub Actions workflow for building release binaries across platforms on tag push.\n\n## Workflow: .github/workflows/cd-release.yml\n\n### Trigger\n- Push tags matching 'v*' (e.g., v0.1.0)\n\n### Build Matrix\n| Target | Runner | Binary Names |\n|--------|--------|-------------|\n| x86_64-unknown-linux-gnu | ubuntu-latest | chesstty-server, client-tui |\n| aarch64-unknown-linux-gnu | ubuntu-latest + cross | chesstty-server, client-tui |\n| x86_64-apple-darwin | macos-13 | chesstty-server, client-tui |\n| aarch64-apple-darwin | macos-latest (arm64) | chesstty-server, client-tui |\n\n### Steps per target\n1. Checkout code\n2. Install Rust stable toolchain\n3. Install protoc (protobuf compiler)\n4. Install cross (for aarch64-linux cross-compilation)\n5. Build: `cargo build --workspace --release` (native) or `cross build --workspace --release --target \u003ctarget\u003e` (cross)\n6. Strip binaries (reduce size)\n7. Package: tar.gz for each platform with both binaries\n8. Upload artifacts\n\n### Packaging Convention\n- Archive name: `chesstty-{version}-{target}.tar.gz`\n- Contains: chesstty-server, client-tui binaries\n- Include LICENSE and README if present\n\n### Cross-compilation Notes\n- Use cross (https://github.com/cross-rs/cross) for ARM Linux targets\n- macOS arm64 builds natively on macos-latest runner\n- Ensure protoc is available for all platforms","notes":"SUPERSEDED by ct-4th (cargo-dist). cargo-dist generates the cross-platform release workflow automatically from ~15 lines of TOML config, replacing the ~200 lines of manual YAML described in this task.","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T18:12:08Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T21:26:08Z","closed_at":"2026-02-23T21:26:03Z","close_reason":"Closed","dependencies":[{"issue_id":"ct-ue2","depends_on_id":"ct-0au","type":"blocks","created_at":"2026-02-22T18:12:32Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-ue2","depends_on_id":"ct-44u","type":"blocks","created_at":"2026-02-22T18:12:32Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-uhn","title":"Decompose SessionState into focused sub-structs","description":"SessionState at server/src/session/state.rs holds 11 fields mixing game logic, engine handle, timer, and analysis. Extract into: GameContext (game, start_fen, phase, game_mode), EngineContext (engine, engine_config, analysis, engine_thinking), TimerContext (timer, move_clock_data). SessionState becomes thin coordinator. Files: state.rs, actor.rs. Complexity: Large.","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:10:16Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:16Z","dependencies":[{"issue_id":"ct-uhn","depends_on_id":"ct-2l2","type":"blocks","created_at":"2026-02-23T19:11:10Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"},{"issue_id":"ct-uhn","depends_on_id":"ct-94u","type":"blocks","created_at":"2026-02-23T19:11:10Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-un4","title":"Consolidate AnalysisScore serialization formats","description":"AnalysisScore has 3 different serialization formats: chess/src/analysis.rs (Display impl), server/src/service/converters.rs:107-110 (proto wire format 'cp 35'), server/src/persistence/sqlite/helpers.rs (SQLite columns). Standardize on canonical serde derive in chess crate. May need SQLite migration for existing data. Files: analysis.rs, converters.rs, sqlite/helpers.rs. Complexity: Medium.","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:10:06Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:06Z","dependencies":[{"issue_id":"ct-un4","depends_on_id":"ct-a29","type":"blocks","created_at":"2026-02-23T19:11:02Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-wcz","title":"Panel scrolling broken: J/K scroll direction inverted in ComponentSelected context","description":"## Summary\n\nPanel scrolling does not work correctly in any game mode when a panel is selected (focused but not expanded). The root cause is a scroll direction inversion for J/K keys in handle_component_selected_context, plus additional secondary issues.\n\n## Reproduction Steps\n\n1. Start any game mode (HvE, EvE, HvH, Review)\n2. Press a number key (1-4) to select/focus a panel\n3. Press J (Shift+j) to scroll DOWN — **nothing happens** (scroll stays at 0)\n4. Press K (Shift+k) to scroll UP — **content scrolls DOWN** (wrong direction)\n\n## Root Cause\n\nIn `client-tui/src/ui/input.rs` lines 518-533, the scroll direction for J/K is inverted relative to vim convention and the expanded context:\n\n```rust\n// SELECTED context (BUGGY):\nKeyCode::Char('J') =\u003e {\n    *scroll = scroll.saturating_sub(SCROLL_INCREMENT); // J = vim DOWN, but subs = scrolls UP\n}\nKeyCode::Char('K') =\u003e {\n    *scroll = scroll.saturating_add(SCROLL_INCREMENT); // K = vim UP, but adds = scrolls DOWN\n}\n```\n\nCompare with the EXPANDED context (lines 580-587) which is CORRECT:\n```rust\n// EXPANDED context (CORRECT):\nKeyCode::Up | KeyCode::Char('k') =\u003e {\n    *scroll = scroll.saturating_sub(SCROLL_INCREMENT); // k = UP = sub ✓\n}\nKeyCode::Down | KeyCode::Char('j') =\u003e {\n    *scroll = scroll.saturating_add(SCROLL_INCREMENT); // j = DOWN = add ✓\n}\n```\n\nThe practical impact: when scroll is at 0 (default), pressing J tries to subtract → stays at 0 → nothing visible happens. The user thinks scrolling is completely broken.\n\n## Secondary Issues\n\n### 1. Shift+arrow/letter pairing is inconsistent (input.rs:518-525)\n`Up | Char('j')` pairs UP arrow with j (vim DOWN). Should be `Up | Char('k')` and `Down | Char('j')`.\n\n### 2. Shift+letter guard unreliable across terminals (input.rs:518-525)\n`KeyCode::Char('j') if key.modifiers.contains(KeyModifiers::SHIFT)` rarely matches because most terminals report Shift+j as `Char('J')`, not `Char('j')` with Shift modifier. The Char('J')/Char('K') fallback arms exist but have the inverted direction.\n\n### 3. GameInfoPanel ignores scroll entirely (game_info_panel.rs:54)\n```rust\nlet paragraph = Paragraph::new(lines);  // Missing .scroll((self.scroll, 0))\nparagraph.render(inner, buf);\n```\nAll other panels correctly apply `.scroll((self.scroll, 0))` but GameInfoPanel does not. Low severity since InfoPanel content is usually short.\n\n### 4. No scroll hint in controls bar\nThe controls bar shows panel selection hints (1-4) but never indicates how to scroll within a selected panel (J/K or Shift+arrows). Users have no discoverability for the scroll feature.\n\n## Affected Components\n- `client-tui/src/ui/input.rs` — handle_component_selected_context (primary)\n- `client-tui/src/ui/widgets/game_info_panel.rs` — missing scroll (secondary)\n- `client-tui/src/ui/fsm/mod.rs` — derive_controls (no scroll hint)\n\n## Proposed Fix\n\n1. Swap J/K direction in handle_component_selected_context to match expanded context:\n   - `Char('J')` → `saturating_add` (scroll DOWN)\n   - `Char('K')` → `saturating_sub` (scroll UP)\n2. Fix Shift+arrow/letter pairing: `Up | Char('k')` and `Down | Char('j')`\n3. Add `.scroll((self.scroll, 0))` to GameInfoPanel (accept scroll param)\n4. Add scroll hint to controls bar when a panel is selected\n\n## Affected Modes\nAll game modes: HumanVsEngine, EngineVsEngine, HumanVsHuman, ReviewMode, AnalysisMode","status":"closed","priority":1,"issue_type":"bug","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T18:09:29Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T10:54:49Z","closed_at":"2026-02-23T10:54:49Z","close_reason":"Fixed: J/K scroll direction now matches vim convention, GameInfoPanel scroll support added, J/K scroll hints added to controls bar"}
{"id":"ct-wzo","title":"Replace Tab-based pane selection with number-key direct selection","description":"The current Tab-based panel navigation is unreliable due to terminal compatibility issues with Tab/Shift+Tab. Replace the entire Tab-cycling navigation model with direct number-key selection (1=InfoPanel, 2=History, 3=Engine, etc.). This simplifies the input model, eliminates the complex section-based traversal state machine, and works reliably in every terminal.","status":"closed","priority":2,"issue_type":"epic","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T00:07:10Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T01:08:21Z","closed_at":"2026-02-22T01:08:21Z","close_reason":"All 8 child tasks complete: number-key mapping, input handlers, controls bar, widget badges, conflict resolution, tests, and cleanup"}
{"id":"ct-x1a","title":"Remove dead ReviewUIState from render_spec.rs","description":"Delete ReviewUIState struct and all 5 methods (lines ~104-172) from client-tui/src/ui/fsm/render_spec.rs. Superseded by ReviewState in review_state.rs. Files: render_spec.rs. Verify: cargo build -p client-tui.","status":"open","priority":1,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:49Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:08:49Z"}
{"id":"ct-x8b","title":"Clarify UCI protocol ownership between crates","description":"UCI handling is split between chess::uci and engine::uci without clear ownership. chess crate should own UCI data types and formatting (move notation, position strings). engine crate should own only UCI process communication (reading/writing to Stockfish stdin/stdout). Make this boundary explicit. Files: chess/src/uci.rs, engine/src/uci/. Complexity: Medium.","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:10:20Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:20Z","dependencies":[{"issue_id":"ct-x8b","depends_on_id":"ct-o78","type":"blocks","created_at":"2026-02-23T19:11:11Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-xys","title":"Extract shared widget helpers module","description":"Create client-tui/src/ui/widgets/helpers.rs with canonical versions of 5 functions duplicated 3-4x: tactical_tag_kind_name, classification_display_name, classification_marker_str, format_mate_info, volatility_bar. Replace copies in review_tabs_panel.rs, advanced_analysis_panel.rs, review_summary_panel.rs with imports. Files: new helpers.rs, widgets/mod.rs, 3 panel files. Complexity: Medium.","status":"open","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:10:00Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:00Z","dependencies":[{"issue_id":"ct-xys","depends_on_id":"ct-as5","type":"blocks","created_at":"2026-02-23T19:11:01Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-ygr","title":"Widget Deduplication","description":"Extract shared TUI widget helpers (tactical_tag_kind_name, classification_display_name, classification_marker_str, format_mate_info, volatility_bar) duplicated 3-4x across widget files into a shared helpers module. Consolidate AnalysisScore serialization.","status":"open","priority":3,"issue_type":"feature","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:08:24Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:32Z","dependencies":[{"issue_id":"ct-ygr","depends_on_id":"ct-47s","type":"blocks","created_at":"2026-02-23T19:08:33Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-z22","title":"Update documentation for SQLite migration","description":"After all SQLite migration implementation tasks are complete, update relevant documentation: README.md (if it mentions persistence/data storage), AGENTS.md, any developer docs. Document the new SQLite backend, DB file location (directories crate paths), migration from JSON, and configuration options (CHESSTTY_DB_PATH env var). This task should be the last one completed in the ct-lx9 epic.","notes":"Part of ct-lx9 (SQLite migration) epic. Should be completed last, after all implementation and testing is done.","status":"closed","priority":3,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-22T09:45:20Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-22T13:56:28Z","closed_at":"2026-02-22T13:56:28Z","close_reason":"Added module-level doc comments to persistence/mod.rs and persistence/sqlite/mod.rs explaining architecture, SQLite backend, JSON migration, and generic manager pattern.","dependencies":[{"issue_id":"ct-z22","depends_on_id":"ct-ivt","type":"blocks","created_at":"2026-02-22T09:47:21Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
{"id":"ct-z3r","title":"Add UDS integration tests for client-server communication","description":"Research shows workspace already has testing infrastructure (wait module, tempfile, tokio::test). Need to add integration tests for UDS path:\\n\\n## Tests to add (server/tests/uds_integration_tests.rs):\\n1. Basic UDS connection test - server starts, client connects\\n2. RPC roundtrip test - create_session, make a move, verify state\\n3. Event streaming test - verify bidirectional streaming works over UDS\\n4. Concurrent client test - multiple clients same socket\\n5. Cleanup test - verify socket file removed on shutdown\\n6. Error handling - timeout, invalid path, server crash\\n\\n## Approach:\\n- Use TempDir for temp socket path\\n- tokio::spawn for server in background\\n- wait_for_socket() for readiness\\n- ChessClient::connect_uds() for connection\\n- #[cfg(unix)] since UDS is Unix-only\\n\\nThis will prevent future regressions like the TCP fallback bug we just fixed.","status":"open","priority":2,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T17:25:22Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T17:25:22Z"}
{"id":"ct-z9b","title":"Extract shared SQLite test_db() helper","description":"3 SQLite repos duplicate identical test_db() async helpers in their #[cfg(test)] modules (session_repo.rs:128, finished_game_repo.rs:198, review_repo.rs:256). Extract into shared server/src/persistence/sqlite/test_utils.rs. Accept 3-line new() constructor duplication as idiomatic Rust. Files: sqlite repo files, new test_utils.rs. Complexity: Small.","status":"open","priority":4,"issue_type":"task","owner":"benedikt.schnatterbeck@fresha.com","created_at":"2026-02-23T19:10:23Z","created_by":"Benedikt Schnatterbeck","updated_at":"2026-02-23T19:10:23Z","dependencies":[{"issue_id":"ct-z9b","depends_on_id":"ct-29l","type":"blocks","created_at":"2026-02-23T19:11:13Z","created_by":"Benedikt Schnatterbeck","metadata":"{}"}]}
